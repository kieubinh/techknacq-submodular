{
  "info": {
    "authors": [
      "Matthias BÃ¼chse",
      "Anja Fischer"
    ],
    "book": "Proceedings of the Workshop on Applications of Tree Automata Techniques in Natural Language Processing",
    "id": "acl-W12-0802",
    "title": "Deciding the Twins Property for Weighted Tree Automata over Extremal Semifields",
    "url": "https://aclweb.org/anthology/W12-0802",
    "year": 2012
  },
  "references": [
    "acl-C96-2215",
    "acl-J07-2003",
    "acl-J08-3004",
    "acl-N06-1045",
    "acl-P06-1055",
    "acl-P08-1064",
    "acl-P09-1067",
    "acl-P09-1108",
    "acl-W05-1506"
  ],
  "sections": [
    {
      "heading": "Abstract",
      "text": [
        "It has remained an open question whether the twins property for weighted tree automata is decidable.",
        "This property is crucial for determinizing such an automaton, and it has been argued that determinization improves the output of parsers and translation systems.",
        "We show that the twins property for weighted tree automata over extremal semifields is decidable."
      ]
    },
    {
      "heading": "1 Introduction",
      "text": [
        "In natural-language processing (NLP), language and translation are often modeled using some kind of grammar, automaton or transducer, such as a probabilistic context-free grammar, a synchronous context-free grammar, a weighted tree automaton, or a tree transducer, among others (May and Knight, 2006; Petrov et al., 2006; Chiang, 2007; Graehl, Knight and May, 2008; Zhang et al., 2008; Pauls and Klein, 2009).",
        "In statistical NLP, the structure of the grammar is extracted heuristically from a large corpus of example sentences or sentence pairs, and the rule weights are estimated using methods from statistics or machine learning.",
        "In general, a grammar such as those named above will be ambiguous, i.e., offering several ways of deriving the same object (sentence or sentence pair).",
        "While the derivation of an object is crucial to the intrinsics of a system, it is neither relevant to the user nor observed in the corpus.",
        "Hence, we speak of spurious ambiguity (Li, Eis-ner and Khudanpur, 2009).",
        "As a consequence, the true importance of an object can only be assessed by aggregating all its derivations.",
        "Unfortunately, this proves computationally intractable in almost all cases: for instance, finding the best string of a probabilistic regular grammar is NP hard (Sima?an, 1996; Casacuberta and de la Higuera, 2000).",
        "Finding the best derivation, on the other hand, is possible in polynomial time (Eppstein, 1998; Huang and Chiang, 2005), and thus, most NLP systems approximate the importance of an object by its best derivation (Li, Eisner and Khudanpur, 2009).",
        "There is, however, a line of research that deals with the costly aggregating approach, and it is closely related to determinization techniques from automata theory.",
        "For instance, May and Knight (2006) argue that the output of a parser or syntax-based translation system can be represented by a weighted tree automaton (wta), which assigns a weight to each parse tree.",
        "Under some circumstances, the wta can be determinized, yielding an equivalent, but unambiguous wta, which offers at most one derivation for each object.",
        "Then the weight of an object is equal to the weight of its derivation, and the aforementioned polynomial-time algorithms deliver exact results.",
        "The caveat of the determinization approach is that deterministic weighted automata are strictly less powerful than their general counterparts, i.e., not every automaton can be determinized.",
        "B?chse, May and Vogler (2010) give a review of known sufficient conditions under which determinization is possible.",
        "One of these conditions requires that (i) the weights are calculated in an extremal semiring, (ii) there is a maximal factorization, and (iii) the wta has the twins property.1",
        "Regarding (i), we note that in an extremal semiring the weight of a parse tree is equal to the weight of its best derivation.",
        "It follows that, while the determinized wta will have at most one derivation per parse tree, its weight will be the weight of the best derivation of the original wta.",
        "The benefit of determinization reduces to removing superfluous derivations from the list of best derivations.",
        "Regarding (ii), the factorization is used in the determinization construction to distribute the weight computation in the determinized automaton between its transition weights and its state be-havior.",
        "A maximal factorization exists for every zero-sum free semifield.",
        "Regarding (iii), the question whether the twins property is decidable has remained open for a long time, until Kirsten (2012)2 gave an affirmative answer for a particular case: weighted string automata over the tropical semiring.",
        "He also showed that the decision problem is PSPACE-complete.",
        "In this paper, we close one remaining gap by adapting and generalizing Kirsten's proof: we show that the twins property is decidable for wta over extremal semifields (Theorem 3.1).",
        "We proceed by recalling the concepts related to determinizing wta, such as ranked trees, semirings, factorizations, wta themselves, and the twins property (Sec.",
        "2).",
        "Then we show our main theorem, including two decision algorithms (Sec.",
        "3).",
        "Finally, we conclude the paper with a discussion and some open questions (Sec.",
        "4)."
      ]
    },
    {
      "heading": "2 Preliminaries 2.1 Ranked Trees",
      "text": [
        "A ranked alphabet is a tuple (?, rk) where ?",
        "is an alphabet, i.e., a finite set, and rk : ??",
        "N assigns an arity to every symbol ?",
        "?",
        "?.",
        "Throughout this paper we will identify (?, rk) with ?.",
        "For every k ?",
        "N the set ?",
        "(k) = {?",
        "?",
        "?",
        "|rk(?)",
        "= k} contains all symbols of arity k. Let H be a set and ?",
        "a ranked alphabet.",
        "The set T?",
        "(H) of trees over ?",
        "indexed by H is defined inductively as the smallest set T such that: (i) H ?",
        "T and (ii) ?",
        "(?1, .",
        ".",
        ".",
        ", ?k) ?",
        "T for every of vectors corresponding to a set of height-bounded trees, while Item (ii) ensures that the latter vectors suffice as the states of the constructed deterministic wta; cf. (B?chse, May and Vogler, 2010, Lm.",
        "5.9 and Lm.",
        "5.8, respectively).",
        "2A manuscript with the same content has been available on Daniel Kirsten's website for a year from Sept. 2010 on.",
        "k ?",
        "N, ?",
        "?",
        "?",
        "(k), and ?1, .",
        ".",
        ".",
        ", ?k ?",
        "T .",
        "We write T?",
        "instead of T?(?).",
        "For every ?",
        "?",
        "T?",
        "(H), we define the set pos(?)",
        "?",
        "N?",
        "of positions of ?",
        "by (i) if ?",
        "?",
        "H , then pos(?)",
        "= {?",
        "}; (ii) if ?",
        "= ?",
        "(?1, .",
        ".",
        ".",
        ", ?k), then pos(?)",
        "= {?}",
        "?",
        "{i ?",
        "w |i ?",
        "{1, .",
        ".",
        ".",
        ", k}, w ?",
        "pos(?i)}.",
        "The mapping ht: T?",
        "(H) ?",
        "N maps each tree ?",
        "to its height, i.e., the length of a longest position of ?.",
        "We denote the label of ?",
        "at position w by ?",
        "(w), the subtree of ?",
        "rooted at w by ?|w, and the tree obtained by replacing the subtree of ?",
        "rooted at position w with ?",
        "?, ??",
        "?",
        "T?",
        "(H), by ?[??]w.",
        "A ?-context is a tree in T?",
        "({z}) that contains exactly one occurrence of the special symbol z.",
        "The set of all ?-contexts is denoted by C?.",
        "Let ?",
        "?",
        "T??C?",
        "and ?",
        "?",
        "C?.",
        "Then the concatenation of ?",
        "and ?, denoted by ?",
        "?",
        "?, is obtained from ?",
        "by replacing the leaf z by ?.",
        "If ?",
        "?",
        "T?, then so is ?",
        "?",
        "?, and likewise for ?",
        "?",
        "C?."
      ]
    },
    {
      "heading": "2.2 Semirings",
      "text": [
        "A semiring (Hebisch and Weinert, 1998; Golan, 1999) is a quintuple S = (S,+, ?, 0, 1) where S is a set, + and ?",
        "are binary, associative operations on S, called addition and multiplication, respectively, + is commutative, ?",
        "distributes over + from both sides, 0 and 1 are elements of S, 0 is neutral with respect to +, 1 is neutral with respect to ?, and 0 is absorbing with respect to ?",
        "(i.e., s ?",
        "0 = 0 = 0 ?",
        "s).",
        "Let S = (S,+, ?, 0, 1) be a semiring.",
        "In notation, we will identify S with S. We call S commutative if the multiplication is commutative; a semifield if it is commutative and for every a ?",
        "S\\{0} there is an a?1 ?",
        "S such that a ?",
        "a?1 = 1; zero-sum free if a + b = 0 implies a = b = 0; zero-divisor free if a ?",
        "b = 0 implies a = 0 or b = 0; and extremal (Mahr, 1984) if a + b ?",
        "{a, b}.",
        "We note that every extremal semiring is also zero-sum free and every semifield is zero-divisor free.",
        "Example 2.1 We present four examples of semirings.",
        "The Boolean semiring B = ({0, 1},?,?, 0, 1), with disjunction and conjunction, is an extremal semifield.",
        "The formal-language semiring (P(??",
        "),?, ?, ?, {?})",
        "over an alphabet ?, with union and language concatenation, is neither commutative nor extremal, but zero-divisor free and zero-sum free.",
        "The tropical semiring (R ?",
        "{?",
        "},min,+,?, 0), with minimum and conventional addition, is",
        "an extremal semifield.",
        "The Viterbi semiring ([0, 1],max, ?, 0, 1) is a commutative, extremal, zero-divisor-free semiring, but not a semifield.",
        "2 Let Q be a set.",
        "The set SQ contains all mappings u : Q ?",
        "S, or, equivalently, all Q-vectors over S. Instead of u(q) we also write uq to denote the q-component of a vector u ?",
        "SQ.",
        "The Q-vector mapping every q to 0 is denoted by 0?.",
        "For every q ?",
        "Q we define eq ?",
        "SQ such that (eq)q = 1, and (eq)p = 0 for every p 6= q."
      ]
    },
    {
      "heading": "2.3 Factorizations",
      "text": [
        "We use the notion of a factorization as defined in (Kirsten and M?urer, 2005).",
        "Let Q be a nonempty finite set.",
        "A pair (f, g) is called a factorization of dimension Q if f : SQ \\ {0?}",
        "?",
        "SQ, g : SQ\\{0?}",
        "?",
        "S, and u = g(u)?f(u) for every u ?",
        "SQ \\ {0?}.",
        "A factorization (f, g) is called maximal if for every u ?",
        "SQ and a ?",
        "S, we have that a ?",
        "u 6= 0?",
        "implies f(a ?",
        "u) = f(u).",
        "Example 2.2 Let Q be a nonempty finite set.",
        "We show three factorizations of dimension Q.",
        "If S is an arbitrary semiring, g(u) = 1 and f(u) = u constitute the trivial factorization.",
        "It is not maximal in general.",
        "If S is a zero-sum free semifield, such as the tropical semiring or the semifield of non-negative",
        "u constitute a factorization (B?chse, May and Vogler, 2010, Lemma 4.2).",
        "It is maximal: f(a ?",
        "As shown in (B?chse, May and Vogler, 2010, Lemma 4.4) a maximal factorization only exists if S is zero-divisor free or |Q |= 1."
      ]
    },
    {
      "heading": "2.4 Weighted Tree Automata",
      "text": [
        "A weighted tree automaton (?sik and Kuich, 2003) is a finite-state machine that represents a weighted tree language, i.e., a mapping ?",
        ": T?",
        "?",
        "S. It assigns a weight to every tree based on weighted transitions.",
        "Formally, a weighted tree automaton (wta) is a tuple A = (Q,?, S, ?, ?)",
        "such that Q is a nonempty finite set (of states), ?",
        "is a ranked alphabet, S is a semiring, ?",
        "is the transition mapping, mapping transitions (q1 ?",
        "?",
        "?",
        "qk, ?, q) into S where q1, .",
        ".",
        ".",
        ", qk, q ?",
        "Q and ?",
        "?",
        "?",
        "(k), and",
        "where ?",
        "= {?",
        "(0), ?",
        "(1), ?",
        "(2)}, S is the arctic semiring (N ?",
        "{??},max,+,?",
        "?, 0), ?",
        "is given by the directed functional hypergraph in Fig. 1, and ?",
        "= (0,??).",
        "Each node in the hypergraph (drawn as circle) corresponds to a state, and each hyperedge (drawn as box with arbitrarily many ingoing arcs and exactly one outgoing arc) represents a weighted transition.",
        "Ingoing arcs of a hyperedge are meant to be read counter-clockwise, starting from the outgoing arc.",
        "The final weight 0 of q1 is indicated by an additional arc.",
        "Transitions not shown have the weight ??.",
        "2",
        "Typically, wta are given initial-algebra semantics (Goguen et al., 1977).",
        "In this paper, we use the equivalent run semantics (F?l?p and Vogler, 2009, Sec. 3.2) as it constitutes the basis for our proofs.",
        "In this setting, every node of a given tree is decorated with a state; this decoration is called a run.",
        "The label of a node, its state, and the states of its successors comprise a transition.",
        "The weight of a run is given by the product of the weights of all these transitions (under ?",
        "), calculated in the semiring S. Roughly speaking, the weight of a tree is then the sum of the weights of all runs on that tree, again calculated in S. Now we formalize the notions of a run and its weight.",
        "For our proofs, we will need runs and their weights to be as easily composable and decomposable as trees and contexts.",
        "Therefore, we will consider trees indexed by semiring elements and even Q-vectors over S. Let H be a set, ?",
        "?",
        "T?",
        "(H), and q ?",
        "Q.",
        "The setR q A(?)",
        "of all runs on ?",
        "that end in state q at the root of ?",
        "is",
        "We will denote the pair (?, ?)",
        "just by ?",
        "and indicate ?",
        "by stating ?",
        "?",
        "RqA(?).",
        "We will also omit the subscript A.",
        "We set R(?)",
        "=",
        "q(?).",
        "Let w ?",
        "pos(?)",
        "and ?",
        "?",
        "Rq(?).",
        "The following notions are defined in the obvious way:",
        "(i) ?|w ?",
        "R?",
        "(w)(?|w), (ii) ?[??",
        "]w ?",
        "Rq(?[??",
        "]w) for every ??",
        "?",
        "T?",
        "(H) and ??",
        "?",
        "R?(w)(??",
        "), and (iii) ?",
        "?",
        "??",
        "?",
        "Rq ?",
        "(?",
        "?",
        "?)",
        "for every q?",
        "?",
        "Q, ?",
        "?",
        "C?, and ??",
        "?",
        "Rq ?",
        "(?)",
        "that maps the z-labelled posi",
        "tion to q.",
        "We will abuse the above notation in two ways: (i) we write ?",
        "[z]w to denote ?[??",
        "]w where ??",
        "is the only element of R?",
        "(w)(z), and (ii) for every s ?",
        "S, we write s ?",
        "?",
        "to denote the run on s ?",
        "?",
        "which coincides with ?.",
        "Let ?",
        "?",
        "T?",
        "(S ?",
        "SQ) and ?",
        "?",
        "R(?).",
        "We define the weight ??",
        "?A ?",
        "S of ?",
        "as follows (omitting the",
        "We define the mapping J.KA : T?",
        "(SQ) ?",
        "SQ such that J?KA(q) = ?",
        "??Rq(?)???.",
        "Again, we will often omit the subscript A.",
        "If we have a factorization (f, g), we will shorten f(J?K) to fJ?K.",
        "We will often use relationships such as ??",
        "?",
        "???",
        "= ????",
        "?",
        "???",
        "and J?",
        "?",
        "?K = JJ?K ?",
        "?K.",
        "The weighted tree language run-recognized by A is the mapping ?A : T?",
        "?",
        "S such that for every ?",
        "?",
        "T?",
        "we have ?A(?)",
        "= ?",
        "q?QJ?Kq ?",
        "?q.",
        "Example 2.4 (Ex.",
        "2.3 contd.)",
        "Figure 2 shows a tree together with a run ?.",
        "We compute ???",
        "(recall that we use the arctic semiring):",
        "It can be shown that J?Kq1 = ht(?)",
        "and J?Kq2 = 0, and thus, that ?A = ht.",
        "2 For every ?",
        "?",
        "T?",
        "(SQ) and ?",
        "?",
        "R(?)",
        "we call ?",
        "victorious (on ?)",
        "if ???",
        "= J?K?(?).",
        "The following observations are based on (B?chse, May and Vogler, 2010, Obs.",
        "5.11 and 5.12).",
        "For the last equation, we note that the summands on the left-hand side form a subset of {???",
        "|?",
        "?",
        "R?(?)(?",
        ")}, which contains ???.",
        "Since S is extremal and ???",
        "= J?K?(?",
        "), the equation holds."
      ]
    },
    {
      "heading": "2.5 Twins Property",
      "text": [
        "We define two binary relations SIBLINGS(A) and TWINS(A) overQ as follows.",
        "Let p, q ?",
        "Q.",
        "Then",
        "First, consider the wta from Ex.",
        "2.3.",
        "Its two states are siblings as witnessed by the tree ?",
        "= ?.",
        "However, they are not twins, as witnessed by the context ?",
        "= ?",
        "(z): Jeq1 ?",
        "?",
        "(z)Kq1 = 1, whereas",
        "Second, consider the wta over the Viterbi semiring shown Fig. 3.",
        "Its two states are siblings as witnessed by the tree ?",
        "= ?.",
        "Furthermore, they are twins because their transitions are symmetric.",
        "Hence, this wta has the twins property.",
        "2 The following observation shows that we can",
        "fined like SIBLINGS(A), with the additional condition that ht(?)",
        "< |Q|2.",
        "PROOF.",
        "The direction ?",
        "is trivial.",
        "We show ?",
        "by contradiction.",
        "Let p, q ?",
        "Q and ?",
        "?",
        "T?",
        "such that (i) J?Kp 6= 0 and J?Kq 6= 0, and (ii) (p, q) 6?",
        "SIB(A).",
        "We assume that ?",
        "is smallest, and we show that we find a smaller counterexample.",
        "By (ii), we have (iii) ht(?)",
        "?",
        "|Q|2.",
        "By (i), there are ?p ?",
        "Rp(?)",
        "and ?q ?",
        "Rq(?)",
        "such that (iv) ??p?",
        "6= 0 and ??q?",
        "6= 0.",
        "By (iii), there are positions w1, w2 such that w1 is above w2, ?p(w1) = ?p(w2), and ?q(w1) = ?q(w2).",
        "Cutting out the slice between w1 and w2, we construct the tree ??",
        "= ?",
        "[?|w2 ]w1 .",
        "Moreover, we construct the runs ?",
        "?p and ?",
        "We have that ???p?",
        "6= 0, ??",
        "?",
        "q?",
        "6= 0, because otherwise (iv) would be violated.",
        "Since S is zero-sum free, we obtain J?",
        "?Kp 6= 0, J?",
        "?Kq 6= 0.",
        "3 Decidability of the Twins Property This section contains our main theorem: Theorem 3.1 The twins property of wta over extremal semifields is decidable.",
        "The following subsections provide the infrastructure and lemmata needed for the proof of the theorem.",
        "Henceforth, we assume that S is an extremal semifield.",
        "As noted in Ex.",
        "2.2, there is a maximal factorization (f, g)."
      ]
    },
    {
      "heading": "3.1 Rephrasing the Twins Relation",
      "text": [
        "In the definition of TWINS(A), we deal with two vectors Jep ?",
        "?K and Jeq ?",
        "?K for each ?",
        "?",
        "C?.",
        "In the following we concatenate these vectors into one, which enables us to use a factorization.",
        "To this end, we construct a wta A ?",
        "A?",
        "that runs two instances of A in parallel, as shown in Fig. 4.",
        "Let A = (Q,?, S, ?, ?)",
        "a wta and A?",
        "= (Q?,?, S, ?",
        "?, ??)",
        "be the wta obtained from A by renaming states via q 7?",
        "q?.",
        "We construct the wta A?",
        "A?",
        "= (Q ?",
        "Q?,?, S, ?",
        "?, ?",
        "?)",
        "where ??",
        "coincides with ?",
        "and ??",
        "on the transitions of A and A?, respectively; it maps all other transitions to 0; and ?",
        "?",
        "coincides with ?",
        "and ??",
        "on Q and Q?, respectively.",
        "For every p, q ?",
        "Q we define the set Tp,q ?",
        "SQ?Q?",
        "by Tp,q = {J(ep + eq?)",
        "?",
        "?KA?A?",
        "|?",
        "?",
        "C?",
        "}; note that ep, eq?",
        "?",
        "SQ?Q?.",
        "With this definition, we observe the following trivial equivalence.",
        "Observation 3.2 Let p, q ?",
        "Q.",
        "Then (p, q) ?",
        "TWINS(A) iff for every u ?",
        "Tp,q we have that up 6= 0 and uq?",
        "6= 0 implies up = uq?.",
        "For every pair (p, q) ?",
        "SIBLINGS(A), a vector u ?",
        "SQ?Q?",
        "is called a critical vector (for (p, q)) if it does not fulfill the centered implication of Obs.",
        "3.2.",
        "Any critical vector in Tp,q thereby witnesses (p, q) 6?",
        "TWINS(A).",
        "Consequently, A has the twins property iff Tp,q contains no critical vector for any (p, q) ?",
        "SIBLINGS(A).",
        "Deciding the twins property thus amounts to searching for a critical vector."
      ]
    },
    {
      "heading": "3.2 Compressing the Search Space",
      "text": [
        "In this subsection we approach the decidability of the twins property by compressing the search space for critical vectors.",
        "First we show that the vectors in Tp,q are scalar multiples of a finite number of vectors.",
        "Lemma 3.3 Let S be a commutative, extremal semiring.",
        "Assume that A has the twins property.",
        "Then there is a finite set S?",
        "?",
        "SQ?Q?",
        "such that for every (p, q) ?",
        "SIBLINGS(A) we have",
        "To this end, we consider each entry in each vector to be induced by an according (victorious) run.",
        "In this spirit we define for every p, q ?",
        "Q and ?",
        "?",
        "C?",
        "the set Cp,q(?)",
        "?",
        "R((ep + eq?)",
        "?",
        "?)Q?Q?",
        "of vectors of runs of A ?",
        "A?",
        "as follows: ?",
        "?",
        "Cp,q(?)",
        "iff (i) ?r ?",
        "Rr((ep + eq?)",
        "?",
        "?)",
        "for every r ?",
        "Q?",
        "Q?",
        "and (ii) for every pair w1, w2 ?",
        "pos(?)",
        "with w1 above w2 and ?r(w1) = ?r(w2) we have that ?r|w1 is victorious on ((ep + eq?)",
        "?",
        "?",
        ")|w1 .",
        "We map each vector of runs to the corresponding weight vector as follows.",
        "For every Q?",
        "?",
        "Q ?",
        "Q?",
        "let ?Q?",
        ": R((ep + eq?)",
        "?",
        "?)Q?Q?",
        "?",
        "SQ?Q?",
        "be the mapping such that for every ?",
        "and q?",
        "?",
        "Q ?",
        "Q?",
        ":",
        "We set S??",
        "= {?Q?(?)",
        "|(p, q) ?",
        "SIBLINGS(A), ?",
        "?",
        "C?, ?",
        "?",
        "Cp,q(?",
        "), Q?",
        "?",
        "Q?",
        "Q?}.",
        "The set S?",
        "is defined in the same way, with the additional condition that ht(?)",
        "< 2|Q|2|Q|.",
        "The first inclusion of (?)",
        "can be proved in the same way as (B?chse, May and Vogler, 2010, Lemma 5.14).",
        "Here we show the second inclusion by contradiction.",
        "To this end, let s ?",
        "S, (p, q) ?",
        "SIBLINGS(A), ?",
        "?",
        "C?, ?",
        "?",
        "Cp,q(?",
        "), and Q?",
        "?",
        "Q ?",
        "Q?",
        "such that s ?",
        "?Q?(?)",
        "6?",
        "S ?",
        "S?, and thus ht(?)",
        "?",
        "2|Q|2|Q|.",
        "We can assume that ??r?",
        "6= 0 for every r ?",
        "Q?",
        "because otherwise we could adjustQ?",
        "without harm.",
        "Finally, we assume that ?",
        "is smallest.",
        "We will construct a new context ?",
        "?",
        "and a corresponding vector ??",
        "?",
        "Cp,q(?",
        "?)",
        "such that ?",
        "?",
        "is smaller than ?",
        "and s ?",
        "?Q?(?)",
        "= s ?",
        "s?",
        "?",
        "?Q?(??)",
        "for some s?",
        "?",
        "S. Then, if the right-hand side is in S ?",
        "S?, so is the left-hand side.",
        "By contraposition, this shows that ?",
        "was not a smallest counterexample, yielding the contradiction.",
        "First, let w be the position in ?",
        "labelled z.",
        "We show that we are able to find a pair (w1, w2) of positions such that w1 is above w2, ?r(w1) = ?r(w2) for every r, and either both or none of w1 and w2 are above w. To this end, we distinguish two cases (cf.",
        "Fig.",
        "5).",
        "(a) If |w |?",
        "|Q|2|Q|, then the length of the common prefix of w and any path of length at least 2|Q|2|Q |can be at most |Q|2|Q|.",
        "Hence, on such a path remain at least |Q|2|Q |+ 1 positions that are not above w. By the pidgeonhole principle, we find said pair (w1, w2).",
        "(b) If |w |> |Q|2|Q|, then we find the pair im",
        "mediately on the path to the position labelled z.",
        "Second, we pick a pair (w1, w2) such that the position w1 has minimal length.",
        "Cutting out the slice between the positions w1 and w2 yields the smaller context ?",
        "?",
        "= ?",
        "[?|w2 ]w1 .",
        "We construct ?",
        "?",
        "accordingly, i.e., ?",
        "?r = ?r[?r|w2 ]w1 for every r ?",
        "Q ?",
        "Q?.",
        "We have that ??",
        "?",
        "Cp,q(?",
        "?",
        "); for this we",
        "need that we chose w1 with minimal length.",
        "Third, we use the twins property to show that there is an s?",
        "?",
        "S such that s ?",
        "?Q?(?)",
        "= s ?",
        "s?",
        "?",
        "?Q?(??).",
        "If Q?",
        "= ?, we set s?",
        "= 0, and the proof is done.",
        "Otherwise we choose some r?",
        "?",
        "Q?",
        "and set",
        "the slice we have cut out.",
        "We prove that ?Q?(?)",
        "= s???Q?(??).",
        "To this end, let r ?",
        "Q?, p?",
        "= ?r(w1) = ?r(w2), and q?",
        "= ?r?",
        "(w1) = ?r?(w2).",
        "Then",
        "At (?)",
        "we have used the twins property.",
        "We show that this is justified.",
        "First, we show that (p?, q?)",
        "?",
        "SIBLINGS(A ?",
        "A?).",
        "To this end, we distinguish two cases.",
        "If z occurs in ?|w2 : by (p, q) ?",
        "SIBLINGS(A) we obtain a tree ?",
        "such that J?Kp 6= 0 and J?Kq 6= 0.",
        "By our assumption we have ??r?",
        "6= 0, ??r??",
        "6= 0, and thus, ??r|w2?",
        "6= 0, ??r?",
        "|w2?",
        "6= 0.",
        "Since S is extremal, and thus, zero-sum free, we obtain J?",
        "?",
        "?|w2Kp?",
        "6= 0, J?",
        "?",
        "?|w2Kq?",
        "6= 0.",
        "If z does not occur in ?|w2 : we derive in a similar fashion that ??r|w2?",
        "6= 0, ??r?",
        "|w2?",
        "6= 0, and thus, J?|w2Kp?",
        "6= 0, J?|w2Kq?",
        "6= 0.",
        "Second, by the twins property, we have that (p?, q?)",
        "?",
        "TWINS(A ?",
        "A?).",
        "Using again that ??r?",
        "6= 0, ??r??",
        "6= 0, we derive ?",
        "?r[z]w2 |w1?",
        "6= 0, ??r?",
        "[z]w2 |w1?",
        "6= 0.",
        "Hence, Jep?",
        "?",
        "?",
        "??Kp?",
        "6= 0, Jeq?",
        "?",
        "?",
        "??Kq?",
        "6= 0.",
        "Consequently, we have (?).",
        "We note that u ?",
        "SQ?Q?, u 6= 0?, is a critical vector iff f(u) is a critical vector.",
        "Hence, applying the factorization to Tp,q for every (p, q) ?",
        "SIBLINGS(A) results in a compressed search space for critical vectors.",
        "It follows from the preceding lemma that the resulting search space is finite.",
        "Lemma 3.4 Let (f, g) be a maximal factorization of dimension Q?",
        "Q?.",
        "Assume thatA has the twins property.",
        "For every (p, q) ?",
        "SIBLINGS(A) the set f(Tp,q \\ {0?})",
        "is finite.",
        "PROOF.",
        "By Lemma 3.3 there is a finite set S?",
        "with f(Tp,q \\ {0?})",
        "?",
        "f(S ?",
        "S ?)",
        "?",
        "f(S?)",
        ", where we used that (f, g) is maximal.",
        "Since S?",
        "is finite, so is f(Tp,q \\ {0?",
        "}).",
        "Ensure: print ?yes?",
        "iff A has the twins property 1: compute SIBLINGS(A) 2: for (p, q) ?",
        "SIBLINGS(A) in parallel do 3: for u ?",
        "f(Tp,q \\ {0?})",
        "do 4: if u is a critical vector then 5: print ?no?",
        "and terminate 6: print ?yes?"
      ]
    },
    {
      "heading": "3.3 Two Decision Algorithms",
      "text": [
        "In this section we consider two decision algorithms.",
        "The first one is part of the following proof.",
        "PROOF (OF THM.",
        "3.1).",
        "Algorithm 1 proceeds as follows.",
        "First, it enumerates SIBLINGS(A).",
        "This is possible as shown by Obs.",
        "2.8.",
        "Second, for each (p, q) ?",
        "SIBLINGS(A) in parallel, it enumerates f(Tp,q \\ {0?",
        "}), checking for critical vectors.",
        "For this step, we distinguish two cases.",
        "Either A has the twins property.",
        "Then, by Lemma 3.4, f(Tp,q \\ {0?})",
        "is finite, and the algorithm will terminate without finding any critical vector, in which case it outputs ?yes?.",
        "OrA does not have the twins property, but then, by Obs.",
        "3.2, the algorithm is guaranteed to find a critical vector at some point, in which case it outputs ?no?.",
        "Note that the parallel processing (line 2) is critical in this case because there may be (p, q) ?",
        "SIBLINGS(A) such that f(Tp,q \\ {0?})",
        "is infinite, but does not contain a critical vector.",
        "Note that Algorithm 1 basically enumerates the set ?",
        "(p,q)?SIBLINGS(A) f(Tp,q \\ {0?}).",
        "In principle, this can be done by enumerating C?",
        "and computing fJ(ep + eq?)",
        "?",
        "?K for each ?",
        "?",
        "C?.",
        "However, the computation of weights already done for sub-contexts of ?",
        "is not reused in this approach.",
        "In the following we show an alternative procedure (Algorithm 2) that does not enumerate C?",
        "explicitly but works on weight vectors instead, thereby avoiding redundant calculation.",
        "This procedure maintains a pair of subsets of SQ?Q?.",
        "It begins with (?, ?)",
        "and keeps adding vectors by applying a monotone operation F until either the second component contains a critical vector or no new vectors are added.",
        "To this end, we define the unary operation F over pairs of subsets of SQ?Q?",
        "by (T,C) 7?",
        "Sec.",
        "1.5.2, Theorem 7) yields that F has a least fixpoint (where we use the pointwise subset order), and that it can be calculated by the saturation procedure outlined above.",
        "In the forthcoming Lemma 3.6, we show that said fixpoint contains the desired set ?",
        "(p,q)?SIBLINGS(A) f(Tp,q \\ {0?}).",
        "This implies both the correctness of our procedure and its termination, by the same line of reasoning as for Algorithm 1.",
        "As a preparation we recall two auxiliary statements.",
        "Observation 3.5 Let S be commutative and (f, g) maximal.",
        "Then for every k ?",
        "0, ?",
        "?",
        "?",
        "(k), and ?1, .",
        ".",
        ".",
        ", ?k ?",
        "T?",
        "(SQ), we have that",
        "PROOF.",
        "In this proof we will often use Obs.",
        "3.5.",
        "For ???",
        "of Statement (i), we refer to (B?chse, May and Vogler, 2010, Lemma 5.8).",
        "We prove ???",
        "of Statement (i) by contradiction.",
        "To this end, let ?",
        "?",
        "T?",
        "a smallest tree such that J?K 6= 0?",
        "and fJ?K 6?",
        "T f .",
        "By definition of T?, there are k ?",
        "0, ?",
        "?",
        "?",
        "(k), and ?1, .",
        ".",
        ".",
        ", ?k ?",
        "T?",
        "such that ?",
        "= ?",
        "(?1, .",
        ".",
        ".",
        ", ?k).",
        "We derive fJ?",
        "(?1, .",
        ".",
        ".",
        ", ?k)K = fJ?",
        "(J?1K, .",
        ".",
        ".",
        ", J?kK)K = fJ?",
        "(fJ?1K, .",
        ".",
        ".",
        ", fJ?kK)K .",
        "Now either fJ?iK ?",
        "T f for every i ?",
        "{1, .",
        ".",
        ".",
        ", k}, but then so is fJ?K, or ?",
        "was not the smallest counterexample.",
        "For ???",
        "of Statement (ii), we show that",
        "which, by definition, is in f(Tp,q \\ {0?}).",
        "We prove ???",
        "of (ii) by contradiction.",
        "To this end, let (p, q) ?",
        "SIBLINGS(A) and ?",
        "?",
        "C?",
        "a smallest context such that fJ(ep + eq?)",
        "?",
        "?K ?",
        "f(Tp,q \\ {0?})",
        "\\ Cf .",
        "Hence, J(ep + eq?)",
        "?",
        "?K 6= 0?.",
        "By (F2), we obtain ?",
        "6= z.",
        "Hence, there are k ?",
        "1, ?",
        "?",
        "?",
        "(k), i ?",
        "{1, .",
        ".",
        ".",
        ", k}, ?1, .",
        ".",
        ".",
        ", ?i?1, ?i+1, .",
        ".",
        ".",
        ", ?k ?",
        "T?, and ?i ?",
        "C?",
        "such that ?",
        "= ?",
        "(?1, .",
        ".",
        ".",
        ", ?i?1, ?i, ?i+1, .",
        ".",
        ".",
        ", ?k).",
        "We have that J?jK 6= 0?",
        "for j 6= i, and J(ep +",
        "By (i), we have that fJ?jK ?",
        "T f .",
        "Now either fJ(ep + eq?)",
        "?",
        "?iK ?",
        "Cf , but then so is fJ(ep + eq?)",
        "?",
        "?K, or ?",
        "was not the smallest counterexample."
      ]
    },
    {
      "heading": "4 Discussion and Further Research",
      "text": [
        "The notion that the twins property can be decided by searching for critical vectors in a compressed search space is due to Kirsten (2012).",
        "We have generalized his work in two ways: (i) We allow arbitrary extremal semifields instead of the tropical semiring.",
        "To this end, we use the notion of a maximal factorization, which is implicit in his work.",
        "(ii) We consider weighted tree automata instead of weighted string automata.",
        "This makes the proof more complex, as we have to distinguish between contexts and trees.",
        "Kirsten's result that deciding the twins property is PSPACE-hard directly transfers to our setting, giving a lower bound on the complexity of our algorithms.",
        "In addition, he shows that the problem is PSPACE-complete by giving an algorithm that is in PSPACE.",
        "We did not investigate whether this result can be transferred to our setting as well.",
        "To check for critical vectors, Algorithm 1 does not need all components from the vectors in Tp,q but only the p-and q?-components; thus in the proof of Lemma 3.3 the height restriction ht(?)",
        "?",
        "2|Q|2|Q |for S?",
        "can ultimately be lowered to ht(?)",
        "?",
        "2|Q|2.",
        "It is an open question which of the two algorithms performs better in practice.",
        "For further research, it would be interesting to investigate sufficient properties for determiniz-ability that do not require the semifield to be extremal.",
        "Then the determinized wta could truly aggregate the weights of the original runs."
      ]
    },
    {
      "heading": "Acknowledgments",
      "text": [
        "The authors wish to thank Heiko Vogler for stimulating remarks on a draft, as well as the anonymous referees for pointing out mistakes.",
        "The first author was financially supported by DFG VO 1011/6-1."
      ]
    }
  ]
}
