{
  "info": {
    "authors": [
      "Mark-Jan Nederhof",
      "Giorgio Satta"
    ],
    "book": "International Conference on Computational Linguistics",
    "id": "acl-C04-1011",
    "title": "Kullback-Leibler Distance Between Probabilistic Context-Free Grammars and Probabilistic Finite Automata",
    "url": "https://aclweb.org/anthology/C04-1011",
    "year": 2004
  },
  "references": [
    "acl-E91-1027",
    "acl-J00-1003",
    "acl-J97-2003",
    "acl-P94-1011"
  ],
  "sections": [
    {
      "heading": "Abstract",
      "text": [
        "We consider the problem of computing the Kullback-Leibler distance, also called the relative entropy, between a probabilistic context-free grammar and a probabilistic finite automaton.",
        "We show that there is a closed-form (analytical) solution for one part of the Kullback-Leibler distance, viz. the cross-entropy.",
        "We discuss several applications of the result to the problem of distributional approximation of probabilistic context-free grammars by means of probabilistic finite automata."
      ]
    },
    {
      "heading": "1 Introduction",
      "text": [
        "Among the many formalisms used for description and analysis of syntactic structure of natural language, the class of context-free grammars (CFGs) is by far the best understood and most widely used.",
        "Many formalisms with greater generative power, in particular the different types of unification grammars, are ultimately based on CFGs.",
        "Regular expressions, with their procedural counterpart of finite automata (FAs), are not able to describe hierarchical, tree-shaped structure, and thereby seem less suitable than CFGs for full analysis of syntactic structure.",
        "However, there are many applications where only partial or approximated analysis of structure is needed, and where full context-free processing could be prohibitively expensive.",
        "Such applications can for example be found in real-time speech recognition systems: of the many hypotheses returned by a speech recognizer, shallow syntactic analysis may be used to select a small subset of those that seem most promising for full syntactic processing in a next phase, thereby avoiding further computational costs for the less promising hypotheses.",
        "As FAs cannot describe structure as such, it is impractical to write the automata required for such applications by hand, and even difficult to derive them automatically by training.",
        "For this reason, the used FAs are often derived from CFGs, by means of some form of approximation.",
        "An overview of different methods of approximating CFGs by FAs, along with an experimental comparison, was given by (Nederhof, 2000).",
        "The next step is to assign probabilities to the transitions of the approximating FA, as the application outlined above requires a qualitative distinction between hypotheses rather than the purely boolean distinction of language membership.",
        "Under certain circumstances, this may be done by carrying over the probabilities from an input probabilistic CFG (PCFG), as shown for the special case of n-grams by (Rimon and Herz, 1991; Stolcke and Segal, 1994), or by training of the FA on a corpus generated by the PCFG (Jurafsky et al., 1994).",
        "See also (Mohri and Nederhof, 2001) for discussion of related ideas.",
        "An obvious question to ask is then how well the resulting PFA approximates the input PCFG, possibly for different methods of determining an FA and different ways of attaching probabilities to the transitions.",
        "Until now, any direct way of measuring the distance between a PCFG and a PFA has been lacking.",
        "As we will argue in this paper, the natural distance measure between probability distributions, the Kullback-Leibler (KL) distance, is difficult to compute.",
        "(The KL distance is also called relative entropy.)",
        "We can however derive a closed-form (analytical) solution for the cross entropy of a PCFG and a PFA, provided the FA underlying the PFA is deterministic.",
        "The difference between the cross-entropy and the KL distance is the entropy of the PCFG, which does not rely on the PFA.",
        "This means that if we are interested in the relative quality of different approximating PFAs with respect to a single input PCFG, the cross-entropy may be used instead of the KL distance.",
        "The constraint of determinism is not a problem in practice, as any FA can be determinized, and FAs derived by approximation algorithms are normally determinized (and minimized).",
        "As a second possible application, we now look more closely into the matter of determinization of finite-state models.",
        "Not all PFAs can be determinized, as discussed by (Mohri, 1997).",
        "This is unfortunate, as deterministic (P)FAs process input with time and space costs independent of the size of the automaton, whereas these costs are linear in the size of the automaton in the nondeterministic case, which may be too high for some real-time applications.",
        "Instead of distribution-preserving determinization, we may therefore approximate a nondeterministic PFA by a deterministic PFA whose probability distribution is close to, but not necessarily identical to, that of the first PFA.",
        "Again, an important question is how close the two models are to each other.",
        "It was argued before by (Juang and Rabiner, 1985; Falkhausen et al., 1995; Vihola et al., 2002) that the KL distance between finite-state models is difficult to compute in general.",
        "The theory developed in this paper shows however that the cross-entropy between the input PFA and the approximating deterministic PFA can be expressed in closed form, relying on the fact that a PFA can be seen as a special case of a PCFG.",
        "Thereby, different approximating deterministic PFAs can be compared for closeness to the input PFA.",
        "We can even compute the KL distance between two unambiguous PFAs, in closed form.",
        "(It is not difficult to see that ambiguity is a decidable property for FAs.)",
        "The structure of this paper is as follows.",
        "We provide some preliminary definitions in Section 2.",
        "Section 3 discusses the expected frequency of a rule in derivations allowed by a PCFG, and explains how such values can be effectively computed.",
        "The KL distance between a PCFG and a PFA is closely related to the entropy of the PCFG, which we discuss in Section 4.",
        "Essential to our approach is the intersection of PCFGs and PFAs, to be discussed in Section 5.",
        "As we show in Section 6, the part of the KL distance expressing the cross-entropy can be computed in closed form, based on this intersection.",
        "Section 7 concludes this paper."
      ]
    },
    {
      "heading": "2 Preliminaries",
      "text": [
        "Throughout the paper we use mostly standard formal language notation, as for instance in (Hopcroft and Ullman, 1979; Booth and Thompson, 1973), which we summarize below.",
        "A context-free grammar (CFG) is a 4-tuple G = (Σ, N, S, R) where Σ and N are finite disjoint sets of terminals and nonterminals, respectively, S E N is the start symbol and R is a finite set of rules.",
        "Each rule has the form A – * α, where A E N and α E (Σ U N)*.",
        "The ‘derives’ relation ==>.",
        "associated with G is defined on triples consisting of two strings α, β E (Σ U N)* and a rule π E R. We write α � β if and only if α is of the form uAδ and β is of the form uγδ, for some u E Σ*, δ E (Σ U N)*, and π = (A – * γ).",
        "A leftmost derivation (for G) is a string d = π1 • • • πm, m > 0, such that α0 7=� α1 7=� • π� αm, for some α0, ... , αm E (Σ U N)*; d = c (where c denotes the empty string) is also a leftmost derivation.",
        "In the remainder of this paper, we will let the term ‘derivation’ refer to ‘leftmost derivation’, unless specified otherwise.",
        "If",
        "A (left-most) derivation d such that S d4 w, w E Σ*, is called a complete derivation.",
        "If d is a complete derivation, we write y(d) to denote the (unique) string w E Σ* such that S d4 w. The language generated by G is the set of all strings y(d) derived by complete derivations, i.e., L(G) = {w IS d4 w, d E R*, w E Σ*}.",
        "It is well-known that there is a one-to-one correspondence between complete derivations and parse trees for strings in L(G).",
        "A probabilistic CFG (PCFG) is a pair Gp = (G, pG), where G is a CFG and pG is a function from R to real numbers in the interval [0, 1].",
        "A PCFG is proper if Eπ =(A – *α) pG (π) = 1 for all A E N. Function pG can be used to associate probabilities to derivations of the underlying CFG G, in the following way.",
        "For",
        "A PCFG is consistent if Ew pG(w) = 1.",
        "Consistency implies that the PCFG defines a probability distribution on the set of terminal strings as well as on the set of grammar derivations.",
        "If a PCFG is proper, then consistency means that no probability mass is lost in ‘infinite’ derivations.",
        "A finite automaton (FA) is a 5-tuple M = (Σ, Q, q0, Q f, T), where Σ and Q are two finite sets of terminals and states, respectively, q0 is the initial state, Qf C Q is the set of final states, and T is a finite set of transitions, each of the form s a H t, where s, t E Q and a E Σ.",
        "A probabilistic finite automaton (PFA) is a pair Mp = (M, pM), where M is an FA and pM is a function from T to real numbers in the interval [0, 1].1 For a fixed (P)FA M, we define a configuration to be an element of Q x Σ*, and we define the relation �- on triples consisting of two configurations and a transition τ E T by: τ (s, w) �- (t, w') if and only if w is of the form aw', for some a E Σ, and τ = (s a a* t).",
        "A complete computation is a string c = τ1 • • • τm, m > 0,",
        "For a PFA Mp=(M,pM), and c=τ1•••τmE T*, m > 0, we define pM (c) = Hjm i=1 pM(τi) if c is a complete computation, and pM (c) = 0 otherwise.",
        "A PFA is consistent if Ec pM (c) = 1.",
        "We say M is unambiguous if for each w E Σ*, c 1sEQf [(q0, w) �- (s, E)] for at most one c E T*.",
        "We say M is deterministic if for each s and a, there is at most one transition s a H t. Determinism implies unambiguity.",
        "It can be more readily checked whether an FA is deterministic than whether it is unambiguous.",
        "Furthermore, any FA can be effectively turned into a deterministic FA accepting the same language.",
        "Therefore, this paper will assume that FAs are deterministic, although technically, unambiguity is sufficient for our constructions to apply."
      ]
    },
    {
      "heading": "3 Expectation of rule frequency",
      "text": [
        "Here we discuss how we can compute the expectation of the frequency of a rule or a non-terminal over all derivations of a probabilistic context-free grammar.",
        "These quantities will be used later by our algorithms.",
        "1Our definition of PFAs amounts to a slight loss of generality with respect to standard definitions, in that there are no epsilon transitions and no probability function on states being final.",
        "We want to avoid these concepts as they would cause some technical complications later in this article.",
        "There is no loss of generality however if we may assume an end-of-sentence marker, which is often the case in practice.",
        "Let (A – * α) E R be a rule of PCFG Gp, and let d E R* be a complete derivation in Gp.",
        "We define f (A – * α; d) as the number of occurrences, or frequency, of A – * α in d. Similarly, the frequency of nonterminal A in d is defined as f (A; d) = Eα f (A – * α; d).",
        "We consider the following related quantities",
        "A method for the computation of these quantities is reported in (Hutchins, 1972), based on the so-called momentum matrix.",
        "We propose an alternative method here, based on an idea related to the inside-outside algorithm (Baker, 1979; Lari and Young, 1990; Lari and Young, 1991).",
        "We observe that we can factorize a derivation d at each occurrence of rule A – * α into an ‘innermost’ part d2 and two ‘outermost’ parts d1 and d3.",
        "We can then write",
        "Next we group together all of the innermost and all of the outermost derivations and write",
        "where",
        "Both outGp (A) and inGp (α) can be described in terms of recursive equations, of which the least fixed-points are the required values.",
        "If GP is proper and consistent, then inGp (α) = 1 for each α ∈ (Σ ∪ N)∗.",
        "Quantities outGp(A) for every A can all be (exactly) calculated by solving a linear system, requiring an amount of time proportional to the cube of the size of Gp; see for instance (Corazza et al., 1991).",
        "On the basis of all the above quantities, a number of useful statistical properties of GP can be easily computed, such as the expected length of derivations, denoted EDL(Gp) and the expected length of sentences, denoted EWL(Gp), discussed before by (Wetherell, 1980).",
        "These quantities satisfy the relations",
        "where for a string γ ∈ (N ∪ Σ)∗ we write |γ|Σ to denote the number of occurrences of terminal symbols in γ."
      ]
    },
    {
      "heading": "4 Entropy of PCFGs",
      "text": [
        "In this section we introduce the notion of deriva-tional entropy of a PCFG, and discuss an algorithm for its computation.",
        "Let GP = (G, pG) be a PCFG.",
        "For a nonterminal A of G, let us define the entropy of A as the entropy of the distribution pG on all rules of the form A → α, i.e., PG(A l0 1 PG( ) ' g pG(A → α).",
        "The derivational entropy of GP is defined as the expectation of the information of the complete derivations generated by Gp, i.e.,",
        "d We now characterize derivational entropy using expected rule frequencies as",
        "As already discussed, under the assumption that GP is proper and consistent we have inGp (α) = 1 for every α.",
        "Thus we can write",
        "The computation of outGp (A) was discussed in Section 3, and also H(A) can easily be calculated.",
        "Under the restrictive assumption that a PCFG is proper and consistent, the characterization in (2) was already known from (Grenander, 1976, Theorem 10.7, pp.",
        "90–92).",
        "The proof reported in that work is different from ours and uses a momentum matrix (Section 3).",
        "Our characterization above is more general and uses simpler notation than the one in (Grenander, 1976).",
        "The sentential entropy, or entropy for short, of GP is defined as the expectation of the information of the strings generated by Gp, i.e.,",
        "assuming 0 · log o = 0, for strings w not generated by Gp.",
        "It is not difficult to see that H(Gp) ≤ Hd(Gp) and equality holds if and only if G is unambiguous (Soule, 1974, Theorem 2.2).",
        "As ambiguity of CFGs is undecidable, it follows that we cannot hope to obtain a closed-form solution for H(Gp) for which equality to (2) is decidable.",
        "We will return to this issue in Section 6.",
        "In order to compute the cross-entropy defined in the next section, we need to derive a single probabilistic model that simultaneously accounts for both the computations of an underlying FA and the derivations of an underlying PCFG.",
        "We start from a construction originally presented in (Bar-Hillel et al., 1964), that computes the intersection of a context-free language and a regular language.",
        "The input consists of a CFGG=(Σ,N,S,R) and anFAM=(Σ,Q, q0, Qf, T); note that we assume, without loss of generality, that G and M share the same set of terminals Σ.",
        "The output of the construction is CFG Gn = (Σ, Nn, Sn, Rn), where Nn = Q × (Σ ∪ N) × Q ∪ {Sn}, and Rn consists of the set of rules that is obtained as follows.",
        "• For each s ∈ Qf, let Sn → (q0, S, s) be a rule of Gn.",
        "• For each rule A → X1 · · · Xm of G and each sequence of states s0, ... , sm of M, with m ≥ 0, let (s0, A, sm) → (s0, X1, s1) ··· (sm-1, Xm, sm) be a rule of Gn; for m = 0, Gn has a rule (s0, A, s0) → E for each state s0.",
        "• For each transition s a → t of M, let (s, a, t) → a be a rule of Gn.",
        "Note that for each rule (s0, A, sm) → (s0, X1, s1) · · · (sm-1, Xm, sm) there is a unique rule A → X1 · · · Xm from which it has been constructed by the above.",
        "Similarly, each rule (s, a, t) → a uniquely identifies a transition s H t. This means that if we take a complete derivation do in Gn, we can extract a sequence h1 (dn) of rules from G and a sequence h2 (dn) of transitions from M, where h1 and h2 are string homomorphisms that we define point-wise as",
        "We define h(dn) = (h1 (dn),h2(dn)).",
        "It can be easily shown that if Sn � w and h(dn) = (d, c), then for the same w we have S d⇒ w and c (q0, w) �- (s, E), some s ∈ Qf.",
        "Conversely, if for some w, d and c we have S d⇒ w and c (q0, w) �- (s, E), some s ∈ Qf, then there is precisely one derivation do such that h(dn) = (d, c) and Sn � w. As noted before by (Nederhof and Satta, 2003), this construction can be extended to apply to a PCFG GP = (G, pG) and an FA M. The output is a PCFG Gn,p = (Gn, pGn ), where Gn is defined as above and pG, is defined by:",
        "• pGn (Sn → (q0, S, s)) = 1; • pGn ((s0, A, sm) \\\\ → (s0, X1, s1) \\ ··· (sm-1, Xm, sm)) = pG (A → X1 ··· Xm); • pGn ((s, a, t) → a) = 1.",
        "Note that Gn,p is non-proper.",
        "More specifically, probabilities of rules with left-hand side Sn or (s0, A, sm) might not sum to one.",
        "This is not a problem for the algorithms presented in this paper, as we have never assumed properness for our PCFGs.",
        "What is most important here is the following property of Gn,p.",
        "If dn, d and c are such that h(dn) = (d, c), then pGn (dn) = pG (d).",
        "Let us now assume that M is deterministic.",
        "(In fact, the weaker condition of M being unambiguous is sufficient for our purposes, but unambiguity is not a very practical condition.)",
        "Given a string w and a transition s a → t of M we define f (s a → t; w) as the frequency (number of occurrences) of s a → t in the unique computation of M, if it exists, that accepts w; this frequency is 0 if w is not accepted by M. On the basis of the above construction of Gn,p and of Section 3, we find"
      ]
    },
    {
      "heading": "6 Kullback-Leibler distance",
      "text": [
        "In this section we consider the Kullback-Leibler distance between a PCFGs and a PFA, and present a method for its optimization under certain assumptions.",
        "Let GP = (G, pG) be a consistent PCFG and let MP = (M, pM) be a consistent PFA.",
        "We demand that M be deterministic (or more generally, unambiguous).",
        "Let us first → → assume that L(G) ⊆ L(M); we will later drop this constraint.",
        "The cross-entropy of Gp and Mp is defined as usual for probabilistic models, viz. as the expectation under distribution pG of the information of the strings generated by M, i.e.,",
        "The Kullback-Leibler distance of Gp and Mp is defined as Quantity D(Gp ||Mp) can also be expressed as the difference between the cross-entropy of Gp and Mp and the entropy of Gp, i.e.,",
        "Let G∩,p be the PCFG obtained by intersecting Gp with the non-probabilistic FA M underlying Mp, as in Section 5.",
        "Using (4) the cross-entropy of Gp and Mp can be expressed as",
        "The values of out , can be calculated easily, as discussed in Section 3.",
        "Computation of H(Gp in closed-form is problematic, as already pointed out in Section 4.",
        "However, for many purposes computation of H(Gp is not needed.",
        "For example, assume that the non-probabilistic FA M underlying MP is given, and our goal is to measure the distance between GP and Mp for different choices of pM Then the choice that minimizes H(G | Mp determines the choice that minimizes",
        "), irrespective of H(Gp).",
        "Formally, we can use the above characterization to compute",
        "are undefined, as their definitions imply a division by pM(w = 0 for w L(G) L(M).",
        "In cases where the non-probabilistic FA M is given, and our goal is to compare the relative distances between GP and MP for different choices of pM it makes sense to ignore strings in L(G) L(M), and define D(G | Mp), H(G | Mp and H(Gp on the domain L(G) L(M).",
        "Our equations above then still hold.",
        "Note that strings in L(M)−L(G can be ignored since they do not contribute non-zero values to D(G ||Mp) and H(Gp ||Mp)."
      ]
    },
    {
      "heading": "7 Conclusions",
      "text": [
        "We have discussed the computation of the KL distance between PCFGs and deterministic PFAs.",
        "We have argued that exact computation is difficult in general, but for determining the relative qualities of different PFAs, with respect to their closeness to an input PCFG, it suffices to compute the cross-entropy.",
        "We have shown that the cross-entropy between a PCFG and a deterministic PFA can be computed exactly.",
        "These results can also be used for comparing a pair of PFAs, one of which is deterministic.",
        "Generalization of PCFGs to probabilistic tree-adjoining grammars (PTAGs) is also possible, by means of the intersection of a PTAG and a PFA, along the lines of (Lang, 1994)."
      ]
    },
    {
      "heading": "Acknowledgements",
      "text": [
        "Helpful comments from Zhiyi Chi are gratefully acknowledged.",
        "The first author is supported by"
      ]
    }
  ]
}
