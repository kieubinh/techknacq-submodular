{
  "info": {
    "authors": [
      "Adam Pauls",
      "John DeNero",
      "Dan Klein"
    ],
    "book": "EMNLP",
    "id": "acl-D09-1147",
    "title": "Consensus Training for Consensus Decoding in Machine Translation",
    "url": "https://aclweb.org/anthology/D09-1147",
    "year": 2009
  },
  "references": [
    "acl-D08-1023",
    "acl-D08-1024",
    "acl-D08-1076",
    "acl-J03-1002",
    "acl-J07-2003",
    "acl-P02-1001",
    "acl-P03-1021",
    "acl-P07-1019",
    "acl-P07-2045",
    "acl-W07-0403"
  ],
  "sections": [
    {
      "text": [
        "Adam Pauls, John DeNero and Dan Klein",
        "Computer Science Division University of California at Berkeley",
        "We propose a novel objective function for dis-criminatively tuning log-linear machine translation models.",
        "Our objective explicitly optimizes the BLEU score of expected n-gram counts, the same quantities that arise in forest-based consensus and minimum Bayes risk decoding methods.",
        "Our continuous objective can be optimized using simple gradient ascent.",
        "However, computing critical quantities in the gradient necessitates a novel dynamic program, which we also present here.",
        "Assuming BLEU as an evaluation measure, our objective function has two principle advantages over standard max BLEU tuning.",
        "First, it specifically optimizes model weights for downstream consensus decoding procedures.",
        "An unexpected second benefit is that it reduces overfltting, which can improve test set BLEU scores when using standard Viterbi decoding."
      ]
    },
    {
      "heading": "1. Introduction",
      "text": [
        "Increasing evidence suggests that machine translation decoders should not search for a single top scoring Viterbi derivation, but should instead choose a translation that is sensitive to the model's entire predictive distribution.",
        "Several recent consensus decoding methods leverage compact representations of this distribution by choosing translations according to n-gram posteriors and expected counts (Tromble et al., 2008; DeNero et al., 2009; Li et al., 2009; Kumar et al., 2009).",
        "This change in decoding objective suggests a complementary change in tuning objective, to one that optimizes expected n-gram counts directly.",
        "The ubiquitous minimum error rate training (MERT) approach optimizes Viterbi predictions, but does not explicitly boost the aggregated posterior probability of desirable n-grams (Och, 2003).",
        "We therefore propose an alternative objective function for parameter tuning, which we call consensus BLEU or CoBLEU, that is designed to maximize the expected counts of the n-grams that appear in reference translations.",
        "To maintain consistency across the translation pipeline, we formulate CoBLEU to share the functional form of BLEU used for evaluation.",
        "As a result, CoBLEU optimizes exactly the quantities that drive efficient consensus decoding techniques and precisely mirrors the objective used for fast consensus decoding in DeNero et al.",
        "(2009).",
        "CoBLEU is a continuous and (mostly) differentiable function that we optimize using gradient ascent.",
        "We show that this function and its gradient are efficiently computable over packed forests of translations generated by machine translation systems.",
        "The gradient includes expectations of products of features and n-gram counts, a quantity that has not appeared in previous work.",
        "We present a new dynamic program which allows the efficient computation of these quantities over translation forests.",
        "The resulting gradient ascent procedure does not require any A;-best approximations.",
        "Optimizing over translation forests gives similar stability benefits to recent work on lattice-based minimum error rate training (Macherey et al., 2008) and large-margin training (Chiang et al., 2008).",
        "We developed CoBLEU primarily to complement consensus decoding, which it does; it produces higher BLEU scores than coupling MERT with consensus decoding.",
        "However, we found an additional empirical benefit: CoBLEU is less prone to overfitting than MERT, even when using Viterbi decoding.",
        "In experiments, models trained to maximize tuning set BLEU using MERT consistently degraded in performance from tuning to test set, while CoBLEU-trained models generalized more robustly.",
        "As a result, we found that optimizing CoBLEU improved test set performance reliably using consensus decoding and occasionally using Viterbi decoding.",
        "Proceedings of the 2009 Conference on Empirical Methods in Natural Language Processing, pages 1418-1427, Singapore, 6-7 August 2009.",
        "©2009 ACL and AFNLP (a) Hypotheses ranked by Otm = 6lm = 1",
        "Sentence/ Il était une rime Reference r. Once upon a rhyme (b) Computing Consensus Bigram Precision",
        "Figure 1: (a) A simple hypothesis space of translations for a single sentence containing three alternatives, each with two features.",
        "The hypotheses are scored under a log-linear model with parameters 6 equal to the identity vector, (b) The expected counts of all bigrams that appear in the computation of consensus bigram precision.",
        "Viterbi derivations under a log-linear model with parameters 6.",
        "Let d*e{fi) = arg vaax.dPe{d\\fi) be the highest scoring derivation d of fa.",
        "For a system employing Viterbi decoding and evaluated by bigram precision, we would want to select 6 to maximize MaxBP(JR,F,6l):",
        "On the other hand, for a system that uses expected bigram counts for decoding, we would prefer to choose 6 such that expected bigram counts match bigrams in the reference sentence.",
        "To this end, we can evaluate an entire posterior distribution over derivations by computing the same clipped precision for expected bigram counts using C6BP(R,F,6):"
      ]
    },
    {
      "heading": "2. Consensus Objective Functions",
      "text": [
        "Our proposed objective function maximizes n-gram precision by adapting the BLEU evaluation metric as a tuning objective (Papineni et al., 2002).",
        "To simplify exposition, we begin by adapting a simpler metric: bigram precision.",
        "Let the tuning corpus consist of source sentences F = /i... fm and human-generated references R = r\\... rm, one reference for each source sentence.",
        "Let be a translation of fa, and let E – &i... em be a corpus of translations, one for each source sentence.",
        "A simple evaluation score for E is its bigram precision BP(iî, E):",
        "where g2 iterates over the set of bigrams in the target language, and c(g2, e) is the count of bigram g2 in translation e. As in BLEU, we \"clip\" the bigram counts of e in the numerator using counts of bigrams in the reference sentence.",
        "Modern machine translation systems are typically tuned to maximize the evaluation score of is the expected count of bigram g2 in all derivations d of fa.",
        "We define the precise parametric form of Pe{d\\fi) in Section 3.",
        "Figure 1 shows proposed translations for a single sentence along with the bigram expectations needed to compute CoBP.",
        "Equation 1 constitutes an objective function for tuning the parameters of a machine translation model.",
        "Figure 2 contrasts the properties of CoBP and MaxBP as tuning objectives, using the simple example from Figure 1.",
        "Consensus bigram precision is an instance of a general recipe for converting n-gram based evaluation metrics into consensus objective functions for model tuning.",
        "For the remainder of this paper, we focus on consensus BLEU.",
        "However, the techniques herein, including the optimization approach of Section 3, are applicable to many differentiable functions of expected n-gram counts.",
        "!By derivation, we mean a translation of a foreign sentence along with any latent structure assumed by the model.",
        "Each derivation corresponds to a particular English translation, but many derivations may yield the same translation.",
        "TM",
        "LM",
        "Pr",
        "Hi) Once on a rhyme",
        "-3",
        "-7",
        "0.67",
        "H2) Once upon a rhyme",
        "-5",
        "-6",
        "0.24",
        "H3) Once upon a time",
        "-9",
        "-3",
        "0.09",
        "Figure 2: These plots illustrate two properties of the objectives max bigram precision (MaxBP) and consensus bigram precision (CoBP) on the simple example from Figure 1.",
        "(a) MaxBP is only sensitive to the convex hull (the solid line) of model scores.",
        "When varying the single parameter Olm, it entirely disregards the correct translation H2 because H2 never attains a maximal model score, (b) A plot of both objectives shows their differing characteristics.",
        "The horizontal segmented line at the top of the plot indicates the range over which consensus decoding would select each hypothesis, while the segmented line at the bottom indicates the same for Viterbi decoding.",
        "MaxBP is only sensitive to the single point of discontinuity between H\\ and H3, and disregards H2 entirely.",
        "CoBP peaks when the distribution most heavily favors H2 while suppressing H\\.",
        "Though H2 never has a maximal model score, if Olm is in the indicated range, consensus decoding would select H2, the desired translation.",
        "The logarithm of the single-reference BLEU metric (Papineni et al., 2002) has the following form:",
        "Above, \\R\\ denotes the number of words in the reference corpus.",
        "The notation (•)_ is shorthand for mm(-, 0).",
        "In the inner sums, gn iterates over all n-grams of order n. In order to adapt BLEU to be a consensus tuning objective, we follow the recipe of Section 2.1: we replace n-gram counts from a candidate translation with expected n-gram counts under the model.",
        "The brevity penalty term in BLEU is calculated using the expected length of the corpus, which",
        "throughout this paper, we use only a single reference, but our objective readily extends to multiple references.",
        "equals the sum of all expected unigram counts.",
        "We call this objective function consensus BLEU, or CoBLEU for short."
      ]
    },
    {
      "heading": "3. Optimizing CoBLEU",
      "text": [
        "Unlike the more common MaxBLEU tuning objective optimized by MERT, CoBLEU is continuous.",
        "For distributions Pe{d\\fi) that factor over synchronous grammar rules and n-grams, we show below that it is also analytically differentiable, permitting a straightforward gradient ascent optimization procedure.",
        "In order to perform gradient ascent, we require methods for efficiently computing the gradient of the objective function for a given parameter setting 6.",
        "Once we have the gradient, we can perform an update at iteration t of the form where rjt is an adaptive step size.",
        "technically, CoBLEU is non-differentiable at some points because of clipping.",
        "At these points, we must compute a sub-gradient, and so our optimization is formally sub-gradient ascent.",
        "See the Appendix for details.",
        "(H=OnceSrhyme} heCtd(h)",
        "lowing expectations:",
        "Figure 3: A hyperedge h represents a \"rule\" used in syntactic machine translation, tail(h) refers to the \"children\" of the rule, while head(h) refers to the \"head\" or \"parent\".",
        "A forest of translations is built by combining the nodes using h to form a new node u = head(h).",
        "Each forest node consists of a grammar symbol and target language boundary words used to track n-grams.",
        "In the above, we keep one boundary word for each node, which allows us to track bigrams.",
        "In this section, we develop an analytical expression for the gradient of CoBLEU, then discuss how to efficiently compute the value of the objective function and gradient.",
        "We first assume the general hypergraph setting of Huang and Chiang (2007), namely, that derivations under our translation model form a hypergraph.",
        "This framework allows us to speak about both phrase-based and syntax-based translation in a unified framework.",
        "We define a probability distribution over derivations d via 6 as:",
        "where w(d) = exp(#T$(d, fi)) is the weight of a derivation and fi) is a featurized representation of the derivation d of fi.",
        "We further assume that these features decompose over hyperedges in the hypergraph, like the one in Figure 3.",
        "That is,",
        "In this setting, we can analytically compute the gradient of CoBLEU.",
        "We provide a sketch of the derivation of this gradient in the Appendix.",
        "In computing this gradient, we must calculate the folwhere £n(d) = J2g„ c(9n, d) is the sum of all n-grams on derivation d (its \"length\").",
        "The first expectation is an expected count of the fcth feature 4>k over all derivations of fi.",
        "The second is an expected length, the total expected count of all n-grams in derivations of fi.",
        "We call the final expectation an expected product of counts.",
        "We now present the computation of each of these expectations in turn.",
        "The expected feature counts E# [c(<pk,d)\\fi] can be written as",
        "We can justify the second step since feature counts are local to hyperedges, i.e. c((/)k,d) = T,hedc((l)k,h).",
        "The posterior probability Pe{h\\fi) can be efficiently computed with inside-outside scores.",
        "Let \\{u) and 0(u) be the standard inside and outside scores for a node u in the forest.",
        "where w(h) is the weight of hyperedge h, given by exp(6T®(h)), and Z(f) = \\{root) is the inside score of the root of the forest.",
        "Computing these inside-outside quantities takes time linear in the number of hyperedges in the forest.",
        "We can compute the expectations of any specific n-grams, or of total n-gram counts £, in the same way as feature expectations, provided that target-side n-grams are also localized to hyperedges (e.g. consider I to be a feature of a hyperedge whose value is the number of n-grams on h).",
        "If the nodes in our forests are annotated with target-side boundary words as in Figure 3, then this will be the case.",
        "Note that this is the same approach used by decoders which integrate a target language model (e.g. Chiang (2007)).",
        "Other work has computed n-gram expectations in the same way (DeNero et al., 2009; Li et al., 2009).",
        "While the previous two expectations can be computed using techniques known in the literature, the expected product of counts E#[c((/>fc, d) ■ £n(d)\\fi] is a novel quantity.",
        "Fortunately, an efficient dynamic program exists for computing this expectation as well.",
        "We present this dynamic program here as one of the contributions of this paper, though we omit a full derivation due to space restrictions.",
        "To see why this expectation cannot be computed in the same way as the expected feature or n-gram counts, we expand the definition of the expectation above to get",
        "Unlike feature and n-gram counts, the product of counts in brackets above does not decompose over hyperedges, at least not in an obvious way.",
        "We can, however, still decompose the feature counts c(<pk, d) over hyperedges.",
        "After this decomposition and a little re-arranging, we get",
        "The quantity De(h\\fi) = Ed",
        ":hed w(d)£n{d) is the sum of the weight-length products of all derivations d containing hyperedge h. In the same way that Pe{h\\fi) can be efficiently computed from inside and outside probabilities, this quantity De(h\\fi) can be efficiently computed with two new inside and outside quantities, which we call ln(u) and On(u).",
        "We provide recursions for these quantities in Figure 4.",
        "Like the standard inside and outside computations, these recursions run in time linear in the number of hyperedges in the forest.",
        "While a full exposition of the algorithm is not possible in the available space, we give some brief intuition behind this dynamic program.",
        "We first define I„(-u):",
        "where du is a derivation rooted at node u.",
        "This is a sum of weight-length products similar to D. To give a recurrence for I, we rewrite it:",
        "Here, we have broken up the total value of £n(d) across hyperedges in d. The bracketed quantity is a score of a marked derivation pair (d, h) where the edge h is some specific element of d. The score of a marked derivation includes the weight of the derivation and the factor £n(h) for the marked hyperedge.",
        "This sum over marked derivations gives the inside recurrence in Figure 4 by the following decomposition.",
        "For ln(u) to sum over all marked derivation pairs rooted at u, we must consider two cases.",
        "First, the marked hyperedge could be at the root, in which case we must choose child derivations from regular inside scores and multiply in the local £n, giving the first summand of I„(-u).",
        "Alternatively, the marked hyperedge is in exactly one of the children; for each possibility we recursively choose a marked derivation for one child, while the other children choose regular derivations.",
        "The second summand of ln(u) compactly expresses a sum over instances of this case.",
        "On(u) decomposes similarly: the marked hyperedge could be local (first summand), under a sibling (second summand), or higher in the tree (third summand).",
        "Once we have these new inside-outside quantities, we can compute D as in Figure 5.",
        "This combination states that marked derivations containing h are either marked at h, below h, or above h.",
        "As a final detail, computing the gradient X7C'nip(0) (see the Appendix) involves a clipped version of the expected product of counts, for which a clipped D is required.",
        "This quantity can be computed with the same dynamic program with a slight modification.",
        "In Figure 4, we show the difference as a choice point when computing £n(h).",
        "As stated, the runtime of computing the required expectations for the objective and gradient is linear in the number of hyperedges in the forest.",
        "The vEtail(h) vEtail(h) wEtail(h) computing undipped counts wEtail(h)",
        "[T,gn c(9n, h)l [Ee[c(gn, d)} < c(gn, n)] computing clipped counts",
        "Figure 4: Inside and Outside recursions for I„(w) and On(u).",
        "IN(w) and OUT(w) refer to the incoming and outgoing hyperedges of u, respectively.",
        "I( ) and O(-) refer to standard inside and outside quantities, defined in Appendix Figure 7.",
        "We initialize with I„(w) = 0 for all terminal forest nodes u and On(root) = 0 for the root node.",
        "£n(h) computes the sum of all n-grams of order n on a hyperedge h.",
        "number of hyperedges is very large, however, because we must track n-gram contexts in the nodes, just as we would in an integrated language model decoder.",
        "These contexts are required both to correctly compute the model score of derivations and to compute clipped n-gram counts.",
        "To speed our computations, we use the cube pruning method of Huang and Chiang (2007) with a fixed beam size.",
        "For regularization, we added an L2 penalty on the size of 6 to the CoBLEU objective, a simple addition for gradient ascent.",
        "We did not find that our performance varied very much for moderate levels of regularization.",
        "The calculation of expected counts can be formulated using the expectation semiring framework of Eisner (2002), though that work does not show how to compute expected products of counts which are needed for our gradient calculations.",
        "Concurrently with this work, Li and Eisner (2009) have generalized Eisner (2002) to compute expected products of counts on translation forests.",
        "The training algorithm of Kakade et al.",
        "(2002) makes use of a dynamic program similar to ours, though specialized to the case of sequence models."
      ]
    },
    {
      "heading": "4. Consensus Decoding",
      "text": [
        "Once model parameters 6 are learned, we must select an appropriate decoding objective.",
        "Several new decoding approaches have been proposed recently that leverage some notion of consensus over the many weighted derivations in a translation forest.",
        "In this paper, we adopt the fast consensus decoding procedure of DeNero et al.",
        "(2009), which directly complements CoBLEU tuning.",
        "For a source sentence /, we first build a translation forest, then compute the expected count of each n-gram in the translation of / under the model.",
        "We extract a fc-best list from the forest, then select the translation that yields the highest BLEU score relative to the forest's expected n-gram counts.",
        "Specifically, let BLEU(e; r) compute the similarity of a sentence e to a reference r based on the n-gram counts of each.",
        "When training with CoBLEU, we replace e with expected counts and maximize 6.",
        "In consensus decoding, we replace r with expected counts and maximize e.",
        "Several other efficient consensus decoding procedures would similarly benefit from a tuning procedure that aggregates over derivations.",
        "For instance, Blunsom and Osborne (2008) select the translation sentence with highest posterior probability under the model, summing over derivations.",
        "Li et al.",
        "(2009) propose a variational approximation maximizing sentence probability that decomposes over n-grams.",
        "Tromble et al.",
        "(2008) minimize risk under a loss function based on the linear Taylor approximation to BLEU, which decomposes over n-gram posterior probabilities."
      ]
    },
    {
      "heading": "5. Experiments",
      "text": [
        "We compared CoBLEU training with an implementation of minimum error rate training on two language pairs.",
        "Our optimization procedure is in principle tractable for any syntactic translation system.",
        "For simplicity, we evaluate the objective using an Inversion Transduction Grammar (ITG) (Wu, 1997) that emits phrases as terminal productions, as in (Cherry and Lin, 2007).",
        "Phrasal ITG models have been shown to perform comparably to the state-of-the art phrase-based system Moses (Koehn et al., 2007) when using the same phrase table (Petrov et al., 2008).",
        "We extract a phrase table using the Moses pipeline, based on Model 4 word alignments generated from GIZA++ (Och and Ney, 2003).",
        "Our final ITG grammar includes the five standard Moses features, an n-gram language model, a length feature that counts the number of target words, a feature that counts the number of monotonie ITG rewrites, and a feature that counts the number of inverted ITG rewrites.",
        "We extracted phrase tables from the Spanish-English and French-English sections of the Eu-roparl corpus, which include approximately 8.5 million words of bitext for each of the language pairs (Koehn, 2002).",
        "We used a trigram language model trained on the entire corpus of English parliamentary proceedings provided with the Europarl distribution and generated according to the ACL 2008 SMT shared task specifications.For tuning, we used all sentences from the 2007 SMT shared task up to length 25 (880 sentences",
        "CoBLEU MERT",
        "Iterations",
        "See http : //www.",
        "statmt.",
        "org/wmt08 for details.",
        "Figure 6: Trajectories of MERT and CoBLEU during optimization show that MERT is initially unstable, while CoBLEU training follows a smooth path to convergence.",
        "Because these two training procedures optimize different functions, we have normalized each trajectory by the final objective value at convergence.",
        "Therefore, the absolute values of this plot do not reflect the performance of either objective, but rather the smoothness with which the final objective is approached.",
        "The rates of convergence shown in this plot are not directly comparable.",
        "Each iteration for MERT above includes 10 iterations of coordinate ascent, followed by a decoding pass through the training set.",
        "Each iteration of CoBLEU training involves only one gradient step.",
        "for Spanish and 923 for French), and we tested on the subset of the first 1000 development set sentences which had length at most 25 words (447 sentences for Spanish and 512 for French).",
        "We compared two techniques for tuning the nine log-linear model parameters of our ITG grammar.",
        "We maximized CoBLEU using gradient ascent, as described above.",
        "As a baseline, we maximized BLEU of the Viterbi translation derivations using minimum error rate training.",
        "To improve optimization stability, MERT used a cumulative fc-best list that included all translations generated during the tuning process.",
        "One of the benefits of CoBLEU training is that we compute expectations efficiently over an entire forest of translations.",
        "This has substantial stability benefits over methods based on A;-best lists.",
        "In Figure 6, we show the progress of CoBLEU as compared to MERT.",
        "Both models are initialized from 0 and use the same features.",
        "This plot exhibits a known issue with MERT training: because new fc-best lists are generated at each iteration, the objective function can change drastically between iterations.",
        "In contrast, CoBLEU converges",
        "Consensus Decoding",
        "Table 1: Performance measured by BLEU using a consensus decoding method over translation forests shows an improvement over MERT when using CoBLEU training.",
        "The first two conditions were initialized by 0 vectors.",
        "The third condition was initialized by the final parameters of MERT training.",
        "Br.",
        "indicates the brevity penalty on the test set.",
        "The * indicates differences which are not statistically significant.",
        "smoothly to its final objective because the forests do not change substantially between iterations, despite the pruning needed to track n-grams.",
        "Similar stability benefits have been observed for lattice-based MERT (Macherey et al., 2008).",
        "We performed experiments from both French and Spanish into English under three conditions.",
        "In the first two, we initialized both MERT and CoBLEU training uniformly with zero weights and trained until convergence.",
        "In the third condition, we initialized CoBLEU with the final parameters from MERT training, denoted MERT^CoBLEU in the results tables.",
        "We evaluated each of these conditions on both the tuning and test sets using the consensus decoding method of DeNero et al.",
        "(2009).",
        "The results appear in Table 1.",
        "In Spanish-English, CoBLEU slightly outperformed MERT under the same initialization, while the opposite pattern appears for French-English.",
        "The best test set performance in both language pairs was the third condition, in which CoBLEU training was initialized with MERT.",
        "This condition also gave the highest CoBLEU objective value.",
        "This pattern indicates that CoBLEU is a useful objective for translation with consensus decoding, but that the gradient ascent optimization is getting stuck in local maxima during tuning.",
        "This issue can likely be addressed with annealing, as described in (Smith and Eisner, 2006).",
        "Interestingly, the brevity penatly results in French indicate that, even though CoBLEU did",
        "Viterbi Decoding",
        "Table 2: Performance measured by BLEU using Viterbi decoding indicates that CoBLEU is less prone to over-fitting than MERT.",
        "not outperform MERT in a statistically significant way, CoBLEU tends to find shorter sentences with higher n-gram precision than MERT.",
        "Table 1 displays a second benefit of CoBLEU training: compared to MERT training, CoBLEU performance degrades less from tuning to test set.",
        "In Spanish, initializing with MERT-trained weights and then training with CoBLEU actually decreases BLEU on the tuning set by 0.8 points.",
        "However, this drop in tuning performance comes with a corresponding increase of 0.6 on the test set, relative to MERT training.",
        "We see the same pattern in French, albeit to a smaller degree.",
        "While CoBLEU ought to outperform MERT using consensus decoding, we expected that MERT would give better performance under Viterbi decoding.",
        "Surprisingly, we found that CoBLEU training actually outperformed MERT in Spanish-English and performed equally well in French-English.",
        "Table 2 shows the results.",
        "In these experiments, we again see that CoBLEU overfit the training set to a lesser degree than MERT, as evidenced by a smaller drop in performance from tuning to test set.",
        "In fact, test set performance actually improved for Spanish-English CoBLEU training while dropping by 2.3 BLEU for MERT."
      ]
    },
    {
      "heading": "6. Conclusion",
      "text": [
        "CoBLEU takes a fundamental quantity used in consensus decoding, expected n-grams, and trains to optimize a function of those expectations.",
        "While CoBLEU can therefore be expected to increase test set BLEU under consensus decoding, it is more surprising that it seems to better regularize learning even for the Viterbi decoding condition.",
        "It is also worth emphasizing that the CoBLEU approach is applicable to functions of expected n-gram counts other than BLEU.",
        "Spanish",
        "Tune",
        "Test",
        "A",
        "Br.",
        "MERT",
        "32.5",
        "30.2",
        "-2.3",
        "0.992",
        "CoBLEU",
        "31.4",
        "30.4",
        "-1.0",
        "0.992",
        "MERT^CoBLEU",
        "31.7",
        "30.8",
        "-0.9",
        "0.992",
        "French",
        "Tune",
        "Test",
        "A",
        "Br.",
        "MERT",
        "32.5",
        "31.1*",
        "-1.4",
        "0.972",
        "CoBLEU",
        "31.9",
        "30.9",
        "-1.0",
        "0.954",
        "MERT^CoBLEU",
        "32.4",
        "31.2*",
        "-0.8",
        "0.953",
        "Spanish",
        "Tune",
        "Test",
        "A",
        "MERT",
        "32.5",
        "30.2",
        "-2.3",
        "MERT^CoBLEU",
        "30.5",
        "30.9",
        "+0.4",
        "French",
        "Tune",
        "Test",
        "A",
        "MERT",
        "32.0",
        "31.0",
        "-1.0",
        "MERT^CoBLEU",
        "31.7",
        "30.9",
        "-0.8",
        "wEtail(h)",
        "We would like to compute the gradient of",
        "To simplify notation, we introduce the functions",
        "Cn{9) represents the sum of the expected counts of all n-grams or order n in all translations of the source corpus F, while CCnV{9) represents the sum of the same expected counts, but clipped with reference counts c(gn,ri).",
        "With this notation, we can write our objective function CoBLEU(_R, F, 9) in three terms:",
        "We first state an identity:",
        "which can be derived by expanding the expectation on the left-hand side and substituting",
        "Using this identity and some basic calculus, the gradient VCn(9) is",
        "heOUT(u)",
        "vÇ^taUih)",
        "Figure 7: Standard Inside-Outside recursions which compute I(w) and O(u).",
        "IN(w) and OUT(w) refer to the incoming and outgoing hyperedges of u, respectively.",
        "We initialize with I(w) = 1 for all terminal forest nodes u and O(root) = 1 for the root node.",
        "These quantities are referenced in Figure 4.",
        "and the gradient VC£lip(tf) is given by where 1 denotes an indicator function.",
        "At the top level, the gradient of the first term (the brevity penalty) is",
        "The gradient of the second term is",
        "lh C^(9) and the gradient of the third term is",
        "Note that, because of the indicator functions, CoBLEU is non-differentiable when Ee[c(gn,d)\\fl] = c(gn, n) or Cn{9) = \\R\\.",
        "Formally, we must compute a sub-gradient at these points.",
        "In practice, we can choose between the gradients calculated assuming the indicator function is 0 or 1 ; we always choose the latter."
      ]
    }
  ]
}
