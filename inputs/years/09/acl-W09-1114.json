{
  "info": {
    "authors": [
      "Abhishek Arun",
      "Chris Dyer",
      "Barry Haddow",
      "Philip Blunsom",
      "Adam Lopez",
      "Philipp Koehn"
    ],
    "book": "CoNLL",
    "id": "acl-W09-1114",
    "title": "Monte Carlo inference and maximization for phrase-based translation",
    "url": "https://aclweb.org/anthology/W09-1114",
    "year": 2009
  },
  "references": [
    "acl-C00-2163",
    "acl-C96-2215",
    "acl-D07-1103",
    "acl-D08-1033",
    "acl-J93-2003",
    "acl-N03-1017",
    "acl-N04-1022",
    "acl-N07-1018",
    "acl-N07-1062",
    "acl-P01-1030",
    "acl-P02-1040",
    "acl-P03-1021",
    "acl-P06-2101",
    "acl-P07-2045",
    "acl-P08-1012",
    "acl-P08-1024",
    "acl-W02-1018",
    "acl-W06-1673"
  ],
  "sections": [
    {
      "text": [
        "Abhishek Arun*",
        "Phil Blunsom*",
        "Adam Lopez*",
        "Barry Haddow*",
        "Philipp Koehn*",
        "*Department of Informatics University of Edinburgh Edinburgh, EH8 9AB, UK",
        "^Department of Linguistics University of Maryland College Park, MD 20742, USA",
        "Recent advances in statistical machine translation have used beam search for approximate NP-complete inference within probabilistic translation models.",
        "We present an alternative approach of sampling from the posterior distribution defined by a translation model.",
        "We define a novel Gibbs sampler for sampling translations given a source sentence and show that it effectively explores this posterior distribution.",
        "In doing so we overcome the limitations of heuristic beam search and obtain theoretically sound solutions to inference problems such as finding the maximum probability translation and minimum expected risk training and decoding."
      ]
    },
    {
      "heading": "1. Introduction",
      "text": [
        "Statistical machine translation (SMT) poses the problem: given a foreign sentence f, find the translation e* that maximises the conditional posterior probability p(e|f).",
        "This probabilistic formulation of translation has driven development of state-of-the-art systems which are able to learn from parallel corpora which were generated for other purposes – a direct result of employing a mathematical framework that we can reason about independently of any particular model.",
        "For example, we can train SMT models using maximum likelihood estimation (Brown et al., 1993; Och and Ney, 2000; Marcu and Wong, 2002).",
        "Alternatively, we can train to minimise probabilistic conceptions of risk (expected loss) with respect to translation metrics, thereby obtaining better results for those metrics (Kumar and Byrne, 2004; Smith and",
        "Eisner, 2006; Zens and Ney, 2007).",
        "We can also use Bayesian inference techniques to avoid resorting to heuristics that damage the probabilistic interpretation of the models (Zhang et al., 2008; DeNero et al., 2008; Blunsom et al., 2009).",
        "Most models define multiple derivations for each translation; the probability of a translation is thus the sum over all of its derivations.",
        "Unfortunately, finding the maximum probability translation is NP-hard for all but the most trivial of models in this setting (Sima'an, 1996).",
        "It is thus necessary to resort to approximations for this sum and the search for its maximum e* .",
        "The most common of these approximations is the max-derivation approximation, which for many models can be computed in polynomial time via dynamic programming (DP).",
        "Though effective for some problems, it has many serious drawbacks for probabilistic inference:",
        "1.",
        "It typically differs from the true model maximum.",
        "2.",
        "It often requires additional approximations in search, leading to further error.",
        "3.",
        "It introduces restrictions on models, such as use of only local features.",
        "4.",
        "It provides no good solution to compute the normalization factor Z(f) required by many probabilistic algorithms.",
        "In this work, we solve these problems using a Monte Carlo technique with none of the above drawbacks.",
        "Our technique is based on a novel Gibbs sampler that draws samples from the posterior distribution of a phrase-based translation model (Koehn et al., 2003) but operates in linear time with respect to the number of input words (Section 2).",
        "We show that it is effective for both decoding (Section 3) and minimum risk training (Section 4)."
      ]
    },
    {
      "heading": "2. A Gibbs sampler for phrase-based translation models",
      "text": [
        "We begin by assuming a phrase-based translation model in which the input sentence, f, is segmented into phrases, which are sequences of adjacent words.",
        "Each foreign phrase is translated into the target language, to produce an output sentence e and an alignment a representing the mapping from source to target phrases.",
        "Phrases are allowed to be reordered during translation.",
        "The model is defined with a log-linear form, with feature function vector h and parametrised by weight vector 6, as described in Koehn et al.",
        "(2003).",
        "The features h of the model are usually few and are themselves typically probabilistic models indicating e.g, the relative frequency of a target phrase translation given a source phrase (translation model), the fluency of the target phrase (language model) and how phrases reorder with respect to adjacent phrases (reordering model).",
        "There is a further parameter A that limits how many source language words may intervene between two adjacent target language phrases.",
        "For the experiments in this paper, we use A = 6.",
        "We use Markov chain Monte Carlo (MCMC) as an alternative to DP search (Geman and Geman, 1984; Metropolis and Ulam, 1949).",
        "MCMC probabilistically generates sample derivations from the complete search space.",
        "The probability of generating each sample is conditioned on the previous sample, forming a Markov chain.",
        "After a long enough interval (referred to as the burn-in) this chain returns samples from the desired distribution.",
        "Our MCMC sampler uses Gibbs sampling, which obtains samples from the joint distribution of a set of random variables X = {X1,..., Xn}.",
        "It starts with some initial state (Xi = x10,..., Xn = xn0), and generates a Markov chain of samples, where each sample is the result of applying a set of Gibbs operators to the previous sample.",
        "Each operator is defined by specifying a subset of the random variables Y C X, which the operator updates by sampling from the conditional distribution P(Y|X \\ Y).",
        "The set X \\ Y is referred to as the Markov blanket and is unchanged by the operator.",
        "In the case of translation, we require a Gibbs sampler that produces a sequence of samples, SN = (e1 ,a1)... (eN, aN), that are drawn from the distribution P(e, a|f).",
        "These samples can thus be used to estimate the expectation of a function h(e, a, f) under the distribution as follows:",
        "Taking h to be an indicator function h = 5(a, a)5(e,e) provides an estimate of P(a, elf), and using h = 5(e, e) marginalises over all derivations a', yielding an estimate of P (e|f).",
        "Our sampler consists of three operators.",
        "Examples of these are depicted in Figure 1.",
        "The RETRANS operator varies the translation of a single source phrase.",
        "Segmentation, alignment, and all other translations are held constant.",
        "The Merge-Split operator varies the source segmentation at a single word boundary.",
        "If the boundary is a split point in the current hypothesis, the adjoining phrases can be merged, provided that the corresponding target phrases are adjacent and the phrase table contains a translation of the merged phrase.",
        "If the boundary is not a split point, the covering phrase may be split, provided that the phrase table contains a translation of both new phrases.",
        "Remaining segmentation points, phrase alignment and phrase translations are held constant.",
        "The REORDER operator varies the target phrase order for a pair of source phrases, provided that the new alignment does not violate reordering limit A.",
        "Segmentation, phrase translations, and all other alignments are held constant.",
        "To illustrate the RETRANS operator, we will assume a simplified model with two features: a bigram language model P1m and a translation model Ptm.",
        "Both features are assigned a weight of 1.",
        "t r l - – V N initial it is some result remarkable",
        "but some result remarkable it is a result remarkable it is a remarkable result",
        "Figure 1: Example evolution of an initial hypothesis via application of several operators, with Markov blanket indicated by shading.",
        "We denote the start of the sentence with S and the language model context with C. Assuming the French phrase c'est can be translated either as it is or but, the Retrans operator at step (b) stochastically chooses an English phrase, e in proportion to the phrases' conditional probabilities.",
        "positions, their complexity is linear in the size of the input.",
        "The Reorder operator iterates over the positions in the input and for the source phrase found at that position considers swapping its target phrase with that of every other source phrase, provided that the reordering limit is not violated.",
        "This means that it can only consider swaps within a fixed-length window, so complexity is linear in sentence length.",
        "To verify that our sampler was behaving as expected, we computed the KL divergence between its inferred distribution q(e|/) and the true distribution over a single sentence (Figure 2).",
        "We computed the true posterior distribution p(e|/) under an Arabic-English phrase-based translation model with parameters trained to maximise expected bleu (Section 4), summing out the derivations for identical translations and computing the partition term Z(/).",
        "As the number of iterations increases, the KL divergence between the distributions approaches zero."
      ]
    },
    {
      "heading": "3. Decoding",
      "text": [
        "Conditional distributions for the Merge-Split and Reorder operators can be derived in an analogous fashion.",
        "A complete iteration of the sampler consists of applying each operator at each possible point in the sentence, and a sample is collected after each operator has performed a complete pass.",
        "Since both the Retrans and Merge-Split operators are applied by iterating over source side word arg maxe p(e\\f ) (MaxDeriv) (MaxTrans) (MinRisk)",
        "In the minimum risk decoder, £e> (e) is any real-valued loss (error) function that computes the error of one hypothesis e with respect to some reference e'.",
        "Our loss is a sentence-level approximation of (1 - bleu).",
        "As noted in section 2, the Gibbs sampler can be used to provide an estimate of the probability distribution P(a, e|/) and therefore to determine the maximum of this distribution, in other words the most likely derivation.",
        "Furthermore, we can marginalise over the alignments to estimate P(e|/)",
        "The task of decoding amounts to finding the single translation e* that maximises or minimises some cri terion given a source sentence f. In this section we consider three common approaches to decoding, maximum translation (MaxTrans), maximum P(it islc'est C) – Ptm(it is\\c est) ' Pim(S it is somee) derivation (MaxDeriv), and minimum risk decoding ( \\ ' ) – Z (MinRisk):",
        "Figure 2: The KL divergence of the true posterior distribution and the distribution estimated by the Gibbs sampler at different numbers of iterations for the Arabic source sentence r}ys wzrA' mAlyzyA yzwr Alflbyn (in English, The prime minister of Malaysia visits the Philippines).",
        "and so obtain the most likely translation.",
        "The Gibbs sampler can therefore be used as a decoder, either running in max-derivation and max-translation mode.",
        "Using the Gibbs sampler in this way makes max-translation decoding tractable, and so will help determine whether max-translation offers any benefit over the usual max-derivation.",
        "Using the Gibbs sampler as a decoder also allows us to verify that it is producing valid samples from the desired distribution.",
        "3.1 Training data and preparation.",
        "The experiments in this section were performed using the French-English and German-English parallel corpora from the WMT09 shared translation task (Callison-Burch et al., 2009), as well as 300k parallel Arabic-English sentences from the NIST MT evaluation training data.",
        "For all language pairs, we constructed a phrase-based translation model as described in Koehn et al.",
        "(2003), limiting the phrase length to 5.",
        "The target side of the parallel corpus was used to train a 3-gram language model.",
        "For the German and French systems, the DEV2006 set was used for model tuning and the TEST2007 (in-domain) and NEWS-DEV2009B (out-of-domain) sets for testing.",
        "For the Arabic system, the MT02 set (10 reference translations) was used for tuning and MT03 (4 reference translations) was used for evaluation.",
        "To reduce the size of the phrase table, we used the association-score technique suggested by Johnson et al.",
        "(2007a).",
        "Translation quality is reported using case-insensitive BLEU (Papineni et al., 2002).",
        "For the experiments reported in this section, we used feature weights trained with minimum error rate training (MERT; Och, 2003) .",
        "Because MERT ignores the denominator in Equation 1, it is invariant with respect to the scale of the weight vector 0 – the Moses implementation simply normalises the weight vector it finds by its 4-norm.",
        "However, when we use these weights in a true probabilistic model, the scaling factor affects the behaviour of the model since it determines how peaked or flat the distribution is.",
        "If the scaling factor is too small, then the distribution is too flat and the sampler spends too much time exploring unimportant probability regions.",
        "If it is too large, then the distribution is too peaked and the sampler may concentrate on a very narrow probability region.",
        "We optimised the scaling factor on a 200-sentence portion of the tuning set, finding that a multiplicative factor of 10 worked best for fr-en and a multiplicative factor of 6 for de-en.",
        "The first experiment shows the effect of different initialisations and numbers of sampler iterations on max-derivation decoding performance of the sampler.",
        "The Moses decoder (Koehn et al., 2007) was used to generate the starting hypothesis, either in full DP max-derivation mode, or alternatively with restrictions on the features and reordering, or with zero weights to simulate a random initialisation, and the number of iterations varied from 100 to 200,000, with a 100 iteration burn-in in each case.",
        "Figure 3 shows the variation of model score with sampler iteration, for the different starting points, and for both language pairs.",
        "French-English German-English",
        "Figure 3: Mean maximum model score, as a function of iteration number and starting point.",
        "The starting point can either be the full max-derivation translation (full), the monotone translation (mono), the monotone translation with no language model (nolm) or the monotone translation with all weights set to zero (zero).",
        "Comparing the best model scores found by the sampler, with those found by the Moses decoder with its default settings, we found that around 50,000 sampling iterations were required for fr-en and 100,000 for de-en, for the sampler to give equivalent model scores to Moses.",
        "From Figure 3 we can see that the starting point did not have an appreciable effect on the model score of the best derivation, except with low numbers of iterations.",
        "This indicates that the sampler is able to move fairly quickly towards the maximum of the distribution from any starting point, in other words it has good mobility.",
        "Running the sampler for 100,000 iterations took on average 1670 seconds per sentence on the French-English data set and 1552 seconds per sentence on German-English.",
        "A further indication of the dependence of sampler accuracy on the iteration count is provided by Figure 4.",
        "In this graph, we show the mean Spearman's rank correlation between the nbest lists of derivations when ranked by (i) model score and (ii) the posterior probability estimated by the sampler.",
        "This measure of sampler accuracy also shows a logarithmic dependence on the sample size.",
        "The sampler also allows us to perform minimum Bayes risk (MBR) decoding, a technique introduced by Kumar and Byrne (2004).",
        "In their work, as an",
        "Figure 4: Mean Spearman's rank correlation of 1000-best list of derivations ranked according to (i) model score and (ii) posterior probability estimated by sampler.",
        "This was measured on a 200 sentence subset of dev2006.",
        "approximation of the model probability distribution, the expected loss of the decoder is calculated by summing over an n-best list.",
        "With the Gibbs sampler, however, we should be able to obtain a much more accurate view of the model probability distribution.",
        "In order to compare max-translation, maxderivation and MBR decoding with the Gibbs sampler, and the Moses baseline, we ran experiments",
        "Table 1: Comparison of the bleu score of the Moses decoder with the sampler running in max-derivation (MaxD), max-translation (MaxT) and minumum Bayes risk (MBR) modes.",
        "The test sets are test2007 (in) and",
        "on both European language pairs, using both the indomain and out-of-domain test sets.",
        "The sampler was initialised with the output of Moses with the feature weights set to zero and restricted to monotone, and run for 100,000 iterations with a 100 iteration burn-in.",
        "The scale factors were set to the same values as in the previous experiment.",
        "The relative translation quality (measured according to BLEU) is shown in Table 1.",
        "These results show very little difference between the decoding methods, indicating that the Gibbs sampling decoder can perform as well as a standard DP based max-derivation decoder with these models, and that there is no gain from doing max-translation or MBR decoding.",
        "However it should be noted that the model used for these experiments was optimised by MERT, for max-derivation decoding, and so the experiments do not rule out the possibility that maxtranslation and MBR decoding will offer an advantage on an appropriately optimised model."
      ]
    },
    {
      "heading": "4. Minimum risk training",
      "text": [
        "In the previous section, we described how our sampler can be used to search for the best translation under a variety of decoding criteria (max derivation, translation, and minimum risk).",
        "However, there appeared to be little benefit to marginalizing over the latent derivations.",
        "This is almost certainly a side effect of the MERT training approach that was used to construct the models so as to maximise the performance of the model on its single best derivation, without regard to the shape of the rest of the distribution (Blunsom et al., 2008).",
        "In this section we describe a further application of the Gibbs sampler: to do unbiased minimum risk training.",
        "While there have been at least two previous attempts to do minimum risk training for MT, both approaches relied on biased k-best approximations (Smith and Eisner, 2006; Zens and Ney, 2007).",
        "Since we sample from the whole distribution, we will have a more accurate risk assessment.",
        "The risk, or expected loss, of a probabilistic translation model on a corpus D, defined with respect to a particular loss function £e (e), where e is the reference translation and e is a hypothesis translation",
        "This value can be trivially computed using equation (2).",
        "In this section, we are concerned with finding the parameters 6 that minimise (3).",
        "Fortunately, with the log-linear parameterization of p(e|f), L is differentiable with respect to 6:",
        "Equation (4) is slightly more complicated to compute using the sampler since it requires the feature expectation in order to evaluate the final term.",
        "However, this can be done simply by making two passes over the samples, computing the feature expectations on the first pass and the gradient on the second.",
        "We have now shown how to compute our objective (3), the expected loss, and a gradient with respect to the model parameters we want to optimise, (4), so we can use any standard first-order optimization technique.",
        "Since the sampler introduces stochasticity into the gradient and objective, we use stochastic gradient descent methods which are more robust to noise than more sophisticated quasi-Newtonian methods experiments below, we updated the learning rate after each step proportionally to difference in successive gradients (Schraudolph, 1999).",
        "For the experiments reported in this section, we used sample sizes of 8000 and estimated the gradient on sets of 100 sentences drawn randomly (with replacement) from the development corpus.",
        "For a",
        "fr-en",
        "de-en",
        "in",
        "out",
        "in",
        "out",
        "Moses",
        "32.7",
        "19.1",
        "27.4",
        "15.9",
        "MaxD",
        "32.6",
        "19.1",
        "27.0",
        "15.5",
        "MaxT",
        "32.6",
        "19.1",
        "27.4",
        "16.0",
        "MBR",
        "32.6",
        "19.2",
        "27.3",
        "16.0",
        "Table 2: Decoding with minimum risk trained systems, compared with decoding with MERT-trained systems on Arabic to English MT03 data",
        "loss function we use 4-gram (1 – BLEU) computed individually for each sentence.",
        "By examining performance on held-out data, we find the model converges typically in fewer than 20 iterations.",
        "During preliminary experiments with training, we observed on a held-out data set (portions of MT04) that the magnitude of the weights vector increased steadily (effectively sharpening the distribution), but without any obvious change in the objective.",
        "Since this resulted in poor generalization we added a regularization term of \\ \\0 – jl\\\\/2a to L. We initially set the means to zero, but after further observing that the translations under all decoding criteria tended to be shorter than the reference (causing a significant drop in performance when evaluated using BLEU), we found that performance could be improved by setting jiwp = – 0.5, indicating a preference for a lower weight on this parameter.",
        "Table 2 compares the performance on Arabic to English translation of systems tuned with MERT (maximizing corpus BLEU) with systems tuned to maximise expected sentence-level BLEU.",
        "Although the performance of the minimum risk model under all decoding criteria is lower than that of the original MERT model, we note that the positive effect of marginalizing over derivations as well as using minimum risk decoding for obtaining good results on this model.",
        "A full exploration of minimum risk training is beyond the scope of this paper, but these initial experiments should help emphasise the versatility of the sampler and its utility in solving a variety of problems.",
        "In the conclusion, we will, however, discuss some possible future directions that can be taken to make this style of training more competitive with standard baseline systems."
      ]
    },
    {
      "heading": "5. Discussion and future work",
      "text": [
        "We have described an algorithmic technique that solves certain problems, but also verifies the utility of standard approximation techniques.",
        "For example, we found that on standard test sets the sampler performs similarly to the DP max-derivation solution and equally well regardless of how it is initialised.",
        "From this we conclude that at least for MERT-trained models, the max-derivation approximation is adequate for finding the best translation.",
        "Although the training approach presented in Section 4 has a number of theoretical advantages, its performance in a one-best evaluation falls short when compared with a system tuned for optimal one-best performance using MERT.",
        "This contradicts the results of Zens and Ney (2007), who optimise the same objective and report improvements over a MERT baseline.",
        "We conjecture that the difference is due to the biased k-best approximation they used.",
        "By considering only the most probable derivations, they optimise a smoothed error surface (as one does in minimum risk training), but not one that is indicative of the true risk.",
        "If our hypothesis is accurate, then the advantage is accidental and ultimately a liability.",
        "Our results are in line with those reported by Smith and Eisner (2006) who find degradation in performance when minimizing risk, but compensate by \"sharpening\" the model distribution for the final training iterations, effectively maximising one-best performance rather minimising risk over the full distribution defined by their model.",
        "In future work, we will explore possibilities for artificially sharpening the distribution during training so as to better anticipate the one-best evaluation conditions typical of MT.",
        "However, for applications which truly do require a distribution over translations, such as re-ranking, our method for minimising expected risk would be the objective of choice.",
        "Using sampling for model induction has two further advantages that we intend to explore.",
        "First, although MERT performs quite well on models with small numbers of features (such as those we considered in this paper), in general the algorithm severely limits the number of features that can be used since it does not use gradient-based updates during optimization, instead updating one feature at a time.",
        "Our training method (Section 4) does not have this limitation, so it can use many more features.",
        "Training",
        "Decoder",
        "MT03",
        "Moses Max Derivation",
        "44.6",
        "MERT",
        "Moses MBR",
        "44.8",
        "Gibbs MBR",
        "44.9",
        "Moses Max Derivation",
        "40.6",
        "MinRisk",
        "MaxTrans",
        "41.8",
        "Gibbs MBR",
        "42.9",
        "Finally, for the DP-based max-derivation approximation to be computationally efficient, the features characterizing the steps in the derivation must be either computable independently of each other or with only limited local context (as in the case of the language model or distortion costs).",
        "This has led to a situation where entire classes of potentially useful features are not considered because they would be impractical to integrate into a DP based translation system.",
        "With the sampler this restriction is mitigated: any function of h(e, f, a) may participate in the translation model subject only to its own computability.",
        "Freed from the rusty manacles of dynamic programming, we anticipate development of many useful features."
      ]
    },
    {
      "heading": "6. Related work",
      "text": [
        "Our sampler is similar to the decoder of Germann et al.",
        "(2001), which starts with an approximate solution and then incrementally improves it via operators such as Retrans and Merge-Split.",
        "It is also similar to the estimator of Marcu and Wong (2002), who employ the same operators to search the alignment space from a heuristic initialisation.",
        "Although the operators are similar, the use is different.",
        "These previous efforts employed their operators in a greedy hill-climbing search.",
        "In contrast, our operators are applied probabilistically, making them theoretically well-founded for a variety of inference problems.",
        "Our use of Gibbs sampling follows from its increasing use in Bayesian inference problems in NLP (Finkel et al., 2006; Johnson et al., 2007b).",
        "Most closely related is the work of DeNero et al.",
        "(2008), who derive a Gibbs sampler for phrase-based alignment, using it to infer phrase translation probabilities.",
        "The use of Monte Carlo techniques to calculate posteriors is similar to that of Chappelier and Rajman (2000) who use those techniques to find the best parse under models where the derivation and the parse are not isomorphic.",
        "To our knowledge, we are the first to apply Monte Carlo methods to maximum translation and minimum risk translation.",
        "Approaches to the former (Blunsom et al., 2008; May and Knight, 2006) rely on dynamic programming techniques which do not scale well without heuristic approximations, while approaches to the latter (Smith and Eisner, 2006; Zens et al., 2007) use biased k-best approximations."
      ]
    },
    {
      "heading": "7. Conclusion",
      "text": [
        "We have described a Gibbs sampler for approximating two intractable problems in SMT: maximum translation decoding (and its variant, minimum risk decoding) and minimum risk training.",
        "By using Monte Carlo techniques we avoid the biases associated with the more commonly used DP based maxderivation (or k-best derivation) approximation.",
        "In doing so we provide a further tool to the translation community that we envision will allow the development and analysis of increasing theoretically well motivated techniques."
      ]
    },
    {
      "heading": "Acknowledgments",
      "text": [
        "This research was supported in part by the GALE program of the Defense Advanced Research Projects Agency, Contract No.",
        "HR0011-06-2-001; and by the EuroMatrix project funded by the European Commission (6th Framework Programme).",
        "The project made use of the resources provided by the Edinburgh Compute and Data Facility (http://www.ecdf.ed.ac.uk/).",
        "The ECDF is partially supported by the eDIKT initiative (http://www.edikt.org.uk/)."
      ]
    }
  ]
}
