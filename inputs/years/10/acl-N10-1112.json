{
  "info": {
    "authors": [
      "Kevin Gimpel",
      "Noah A. Smith"
    ],
    "book": "Human Language Technologies: the 2010 Annual Conference of the North American Chapter of the Association for Computational Linguistics",
    "id": "acl-N10-1112",
    "title": "Softmax-Margin CRFs: Training Log-Linear Models with Cost Functions",
    "url": "https://aclweb.org/anthology/N10-1112",
    "year": 2010
  },
  "references": [
    "acl-D07-1033",
    "acl-H05-1087",
    "acl-J96-1002",
    "acl-P02-1062",
    "acl-P03-1021",
    "acl-P06-2101",
    "acl-W02-1001",
    "acl-W03-0419",
    "acl-W04-3250"
  ],
  "sections": [
    {
      "text": [
        "Kevin Gimpel Noah A. Smith",
        "We describe a method of incorporating task-specific cost functions into standard conditional log-likelihood (CLL) training of linear structured prediction models.",
        "Recently introduced in the speech recognition community, we describe the method generally for structured models, highlight connections to CLL and max-margin learning for structured prediction (Taskar et al., 2003), and show that the method optimizes a bound on risk.",
        "The approach is simple, efficient, and easy to implement, requiring very little change to an existing CLL implementation.",
        "We present experimental results comparing with several commonly-used methods for training structured predictors for named-entity recognition."
      ]
    },
    {
      "heading": "1. Introduction",
      "text": [
        "Conditional random fields (CRFs; Lafferty et al., 2001) and other conditional log-linear models (Berger et al., 1996) achieve strong performance for many NLP problems, but the conditional log-likelihood (CLL) criterion optimized when training these models cannot take a task-specific cost function into account.",
        "In this paper, we describe a simple approach for training conditional log-linear models with cost functions.",
        "We show how the method relates to other methods and how it provides a bound on risk.",
        "We apply the method to train a discriminative model for named-entity recognition, showing a statistically significant improvement over CLL."
      ]
    },
    {
      "heading": "2. Structured Log-Linear Models",
      "text": [
        "Let X denote a structured input space and, for a particular x G X, let Y (x) denote a structured output space for x.",
        "The size of Y(x) is often exponential in x, which differentiates structured prediction from multiclass classification.",
        "For named-entity recognition, for example, x might be a sentence and Y (x) the set of all possible named-entity labelings for the sentence.",
        "Given an x G X and a y G Y(x), we use a conditional log-linear model for pe(y|x):",
        "where f (x,y) is a feature vector representation of x and y and 9 is a parameter vector containing one component for each feature.",
        "Many criteria exist for training the weights 9.",
        "We next review three choices in detail.",
        "For the following, we assume a training set consisting of n examples {(x(i), y(i) )}n=1.",
        "Some criteria will make use of a task-specific cost function that measures the extent to which a structure y differs from the true structure y(i), denoted by cost(y(i), y).",
        "The learning problem for maximizing conditional log-likelihood is shown in Eq.",
        "3 in Fig. 1 (we transform it into a minimization problem for easier comparison).",
        "This criterion is commonly used when a probabilistic interpretation of the model is desired.",
        "An alternative approach to training structured linear classifiers is based on maximum-margin Markov networks (Taskar et al., 2003).",
        "The basic idea is to choose weights such that the linear score of each (x(i), y(i)) is better than (x(i), y) for all alternatives y G Y(x(i)) \\ {y(i)}, with a larger margin for those y with higher cost.",
        "The \"margin rescaling\" form of this training criterion is shown in Eq.",
        "4.",
        "Note that the cost function is incorporated into the criterion.",
        "Risk is defined as the expected value of the cost with respect to the conditional distribution pe (y|x); on training data:",
        "With a log-linear model, learning then requires solving the problem shown in Eq.",
        "5.",
        "Unlike the previous two criteria, risk is typically non-convex.",
        "Risk minimization first appeared in the speech recognition community (Kaiser et al., 2000; Povey and Woodland, 2002).",
        "In NLP, Smith and Eisner (2006) minimized risk using k-best lists to define the distribution over output structures.",
        "Li and Eisner (2009) introduced a novel semiring for minimizing risk using dynamic programming; Xiong et al.",
        "(2009) minimized risk in a CRF.",
        "Many other criteria have been proposed to attempt to tailor training conditions to match task-specific evaluation metrics.",
        "These include the average per-label marginal likelihood for sequence labeling (Kakade et al., 2002), minimum error-rate training for machine translation (Och, 2003), F1 for logistic regression classifiers (Jansche, 2005), and a wide range of possible metrics for sequence labeling and segmentation tasks (Suzuki et al., 2006)."
      ]
    },
    {
      "heading": "3. Softmax-Margin",
      "text": [
        "The softmax-margin objective is shown as Eq.",
        "6 and is a generalization of that used by Povey et al.",
        "(2008) and similar to that used by Sha and Saul (2006).",
        "The simple intuition is the same as the intuition in max-margin learning: high-cost outputs for x(i)should be penalized more heavily.",
        "Another view says that we replace the probabilistic score inside the exp function of CLL with the \"cost-augmented\" score from max-margin.",
        "A third view says that we replace the \"hard\" maximum of max-margin with the \"softmax\" (log £ exp) from CLL; hence we use the name \"softmax-margin.\"",
        "Like CLL and max-margin, the objective is convex; a proof is provided in Gimpel and Smith (2010).",
        "We next show how the softmax-margin criterion (Eq.",
        "6) bounds the risk criterion (Eq.",
        "5).",
        "We first define some additional notation:",
        "for some function F : Y(x(i)) – R. First note that the softmax-margin objective (Eq.",
        "6) is equal to:",
        "The first term must be nonnegative.",
        "Taking each part of the second term, and using Jensen's inequality, which is exactly Eq.",
        "5.",
        "Softmax-margin is also an upper bound on the CLL criterion because, assuming cost is nonnegative, log E [exp cost] > 0.",
        "Furthermore, softmax-margin is a differentiable upper bound on max-margin, because the softmax function is a differentiable upper bound on the max function.",
        "We note that it may also be interesting to consider minimizing the function Ei=1 logE(i)[expcost(y(i), •)], since it is an upper bound on risk but requires less computation for computing the gradient.",
        "We call this objective the Jensen risk bound and include it in our experimental comparison below.",
        "Most methods for training structured models with cost functions require the cost function to decompose across the pieces of the structure in the same way as the features, such as the standard methods for maximizing margin and minimizing risk (Taskar et al., 2003; Li and Eisner, 2009).",
        "If the same conditions hold, softmax-margin training can be implemented atop standard CRF training simply by adding additional \"features\" to encode the local cost components, only when computing the partition function during training.",
        "The weights of these \"cost features\" are not learned."
      ]
    },
    {
      "heading": "4. Experiments",
      "text": [
        "We consider the problem of named-entity recognition (NER) and use the English data from the CoNLL 2003 shared task (Tjong Kim Sang and De Meulder, 2003).",
        "The data consist of news articles",
        "Figure 1: Objective functions for training linear models.",
        "Regularization terms (e.g., C =\\ #) are not shown here.",
        "annotated with four entity types: person, location, organization, and miscellaneous.",
        "Our experiments focus on comparing training objectives for structured sequential models for this task.",
        "For all objectives, we use the same standard set of feature templates, following Kazama and Torisawa (2007) with additional token shape like those in Collins (2002b) and simple gazetteer features.",
        "A feature was included if it occurred at least once in training data (total 1,312,255 features).",
        "The task is evaluated using the F\\ score, which is the harmonic mean of precision and recall (computed at the level of entire entities).",
        "Since this metric is computed from corpus-level precision and recall, it is not easily decomposable into features used in standard chain CRFs.",
        "For simplicity, we only consider Hamming cost in this paper; experiments with other cost functions more targeted to NER are presented in Gimpel and Smith (2010).",
        "We compared softmax-margin to several baselines: the structured perceptron (Collins, 2002a), 1-best MIRA with cost-augmented inference (Crammer et al., 2006), CLL, max-margin, risk, and our Jensen risk bound (JRB) introduced above.",
        "We used L2 regularization, experimenting with several coefficients for each method.",
        "For CLL, softmax-margin, max-margin, and MIRA, we used regularization coefficients C G {0.01, 0.1,1}.",
        "Risk has not always been used with regularization, as regularization does not have as clear a probabilistic interpretation with risk as it does with CLL; so, for risk and JRB we only used C G {0.0, 0.01}.",
        "In addition, since these two objectives are non-convex, we initialized with the output of the best-performing CLL model on dev data (which was the CLL model with C = 0.01).",
        "All methods except CLL and the perceptron make use of a cost function, for which we used Hamming cost.",
        "We experimented with different fixed multipliers m for the cost function, for m G {1, 5,10,20}.",
        "The hyperparameters C and m were tuned on the development data and the best-performing combination was used to label the test data.",
        "We also tuned the decision to average parameters across all training iterations; this has generally been found to help the perceptron and MIRA, but in our experiments had mixed results for the other methods.",
        "We ran 100 iterations through the training data for each method.",
        "For CLL, softmax-margin, risk, and JRB, we used stochastic gradient ascent with a fixed step size of 0.01.",
        "For max-margin, we used stochastic subgradient ascent (Ratliff et al., 2006) also with a fixed step size of 0.01.",
        "For the perceptron and MIRA, we used their built-in step size formulas.",
        "Table 1 shows our results.",
        "On test data, softmax-margin is statistically indistinguishable from MIRA, risk, and JRB, but performs significantly better than CLL, max-margin, and the perceptron (p < 0.03, paired bootstrap with 10,000 samples; Koehn,",
        "CLL:",
        "min",
        "9",
        "]T-0T/(x(i),y(i))+log ]T exp{0Tf(x(i),y)} »=i yey(xW)",
        "(3)",
        "Max-Margin:",
        "min",
        "9",
        "V -0Tf(x(i),y(i)) + max) (oT f (x(i), y) + cost(y(i), yj)",
        "(4)",
        "Risk:",
        "min",
        "9",
        "Y Y cost(y(i),y) eXp{öTf (af,y)}",
        "(5)",
        "Softmax-Margin:",
        "min 9",
        "n",
        "]T-öTf (x(i),y(i))+log ]T exp{eTf (x(i),y)+cost(y(i),y)}",
        "»=i yey(x(i))",
        "(6)",
        "Table 1: Results on development and test sets, along with hyperparameter values chosen using development set.",
        "2004).",
        "It may be surprising that an improvement of 0.38 in Fi could be significant, but this indicates that the improvements are not limited to certain categories ofphenomena in a small number ofsentences but rather appear throughout the majority of the test set.",
        "The Jensen risk bound performs comparably to risk, and takes roughly half as long to train."
      ]
    },
    {
      "heading": "5. Discussion",
      "text": [
        "The softmax-margin approach offers (1) a convex objective, (2) the ability to incorporate task-specific cost functions, and (3) a probabilistic interpretation (which supports, e.g., hidden-variable learning and computation of posteriors).",
        "In contrast, max-margin training and MIRA do not provide (3); risk and JRB do not provide (1); and CLL does not support (2).",
        "Furthermore, softmax-margin training improves over standard CLL training of CRFs, is straightforward to implement, and requires the same amount of computation as CLL.",
        "We have also presented the Jensen risk bound, which is easier to implement and faster to train than risk, yet gives comparable performance.",
        "The primary limitation of all these approaches, including softmax-margin, is that they only support cost functions that factor in the same way as the features of the model.",
        "Future work might exploit approximate inference for more expressive cost functions."
      ]
    },
    {
      "heading": "Acknowledgments",
      "text": [
        "We thank the reviewers, John Lafferty, and Andre Martins for helpful comments and feedback on this work.",
        "This research was supported by NSF grant IIS-0844507.",
        "Method",
        "Dev.",
        "Test",
        "(C, m, avg.?)",
        "Perceptron",
        "90.48",
        "83.98",
        "(Y)",
        "MIRA",
        "91.13",
        "85.72",
        "(0.01, 20, Y)",
        "CLL",
        "90.79",
        "85.46",
        "(0.01, n)",
        "Max-Margin",
        "91.17",
        "85.28",
        "(0.01, 1, Y)",
        "Risk",
        "91.14",
        "85.59",
        "(0.01, 10, N)",
        "JRB",
        "91.05",
        "85.65",
        "(0.01, 1, N)",
        "Softmax-Margin",
        "91.30",
        "85.84",
        "(0.01, 5, N)"
      ]
    }
  ]
}
