{
  "info": {
    "authors": [
      "Philip Williams",
      "Philipp Koehn"
    ],
    "book": "Proceedings of the Sixth Workshop on Statistical Machine Translation",
    "id": "acl-W11-2126",
    "title": "Agreement Constraints for Statistical Machine Translation into German",
    "url": "https://aclweb.org/anthology/W11-2126",
    "year": 2011
  },
  "references": [
    "acl-C04-1024",
    "acl-D07-1091",
    "acl-H05-1085",
    "acl-N03-1017",
    "acl-N06-1032",
    "acl-P02-1040",
    "acl-P03-1021",
    "acl-P05-1033",
    "acl-P07-1017",
    "acl-P07-2045",
    "acl-P84-1075",
    "acl-W01-1407",
    "acl-W04-3250",
    "acl-W06-1606",
    "acl-W08-0319",
    "acl-W09-0425"
  ],
  "sections": [
    {
      "text": [
        "Philip Williams and Philipp Koehn",
        "Languages with rich inflectional morphology pose a difficult challenge for statistical machine translation.",
        "To address the problem of morphologically inconsistent output, we add unification-based constraints to the target-side of a string-to-tree model.",
        "By integrating constraint evaluation into the decoding process, implausible hypotheses can be penalised or filtered out during search.",
        "We use a simple heuristic process to extract agreement constraints for German and test our approach on an English-German system trained on WMT data, achieving a small improvement in translation accuracy as measured by BLEU."
      ]
    },
    {
      "heading": "1. Introduction",
      "text": [
        "Historically, most work in statistical machine translation (SMT) has focused on translation into English.",
        "Languages with richer inflectional morphologies pose additional challenges for translation and conventional SMT approaches tend to perform poorly when either source or target language has rich morphology (Koehn, 2005).",
        "For complex source inflection, a successful approach has been to cluster inflectional variants into equivalence classes.",
        "This removes information that is redundant for translation and can be performed as a preprocessing step for input to a conventional surface form based translation model (Nießen and Ney,",
        "Osborne, 2006).",
        "For complex target inflection,",
        "Minkov et al.",
        "(2007) investigate how postprocessing can be used to generate inflection for a system that produces uninflected output.",
        "Their approach is successfully applied to English-Arabic and English-Russian systems by Toutanova et al.",
        "(2008).",
        "Another promising line of research involves the direct integration of linguistic information into SMT models.",
        "Koehn and Hoang (2007) generalise the phrase-based model's representation of the word from a string to a vector, allowing additional features such as part-of-speech and morphology to be associated with, or even to replace, surface forms during search.",
        "Luong et al.",
        "(2010) decompose words into morphemes and use this extended representation throughout the training, tuning, and testing pipeline.",
        "Departing further from traditional SMT models, the transfer-based systems of Riezler and Maxwell (2006), Bojar and Hajic (2008), and Graham et al.",
        "(2009) employ rich feature structure representations for linguistic attributes, but have so far been limited by their dependence on non-stochastic parsers with limited coverage.",
        "The Stat-XFER transfer-based framework (Lavie, 2008) is neutral with regard to the rule acquisition method and the author describes a manually developed Hebrew-English transfer grammar, which includes a small number of constraints between agreement features.",
        "In Hanneman et al.",
        "(2009) the framework is used with a large automatically-extracted grammar, though this does not use feature constraints.",
        "In this paper we propose a model that retains the use of surface forms during decoding whilst also checking linguistic constraints defined over associated feature structures.",
        "Specifically, we extend a string-to-tree model by adding unification-based constraints to the target-side of the synchronous grammar.",
        "We suggest that such a constraint system can:",
        "• improve the model by enforcing inflectional consistency in combinations unseen by the language model",
        "• improve search by allowing the early elimination of morphologically-inconsistent hypotheses",
        "To evaluate the approach, we develop a system for English-German with constraints to enforce intra-NP/PP and subject-verb agreement, and with a simple probabilistic model for NP case."
      ]
    },
    {
      "heading": "2. Preliminaries",
      "text": [
        "There is an extensive literature on constraint-based approaches to grammar, employing a rich variety of terminology and linguistic devices.",
        "We use only a few of the core ideas, which we briefly describe in this section.",
        "We borrow the terminology and notation of PATR-II (Shieber, 1984), a minimal constraint-based formalism that extends context-free grammar.",
        "Central to our model are the concepts of feature structures and unification.",
        "Feature structures are of two kinds:",
        "• atomic feature structures are untyped, indivisible values, such as NP, nom, or sg",
        "• complex feature structures are partial functions mapping features to values, the values themselves being feature structures.",
        "Complex feature structures are conventionally written as attribute-value matrices.",
        "For example, the following might represent lexical entries for the German definite article, die, and the German noun, Katze, meaning cat:",
        "case decl gender number",
        "acc weak fem sg acc fem sg",
        "An equivalent representation, and the one we use for implementation, is that of a rooted, labelled, directed acyclic graph.",
        "A value belonging to a complex feature structure can be specified using a path notation that describes the chain of features in enclosing feature structures.",
        "In the examples above, the path ( agr gender ) specifies the atomic value fern.",
        "Informally, unification is a merging operation that given two feature structures, yields the minimal feature structure containing all information from both inputs.",
        "A unification failure results if the input feature structures have mutually-conflicting values.",
        "The subject of unification, both in the context of natural language processing and more generally, is surveyed in Knight (1989).",
        "In this work, we use destructive graph-based unification, which results in the source feature structures sharing values upon unification.",
        "For example, the result of unifying the agreement values for the feature structures above would be:",
        "die – .",
        "The index boxes are used to indicate that a value is shared."
      ]
    },
    {
      "heading": "3. Grammar",
      "text": [
        "In this section we describe the synchronous grammar used in our string-to-tree model.",
        "Rule extraction is similar to the syntax-augmented model of Zollmann and Venugopal (2006), though we do not use extended categories in this work.",
        "We then describe how we extend the grammar with target-side constraints.",
        "Our translation model is based on a synchronous context-free grammar (SCFG) learned from a parallel corpus.",
        "Rule extraction follows the hierarchical phrase-based algorithm of Chiang (2005; 2007).",
        "Source non-terminals are given the undistinguished label X, whereas the target non-terminals are given part-of-speech and constituent labels obtained from a parse of the target-side of the parallel corpus.",
        "Rules in which the target span is not covered by a parse tree constituent are discarded.",
        "Compared with the hierarchical phrase-based model, the restriction to constituent target phrases reduces the total grammar size and the addition of linguistic labels reduces the problem of spurious ambiguity.",
        "We therefore relax Chiang's (2007) rule filtering in the following ways:",
        "1.",
        "Up to seven source-side terminal / non-terminal elements are allowed.",
        "2.",
        "Rules with scope greater than three are filtered out (Hopkins and Langmead, 2010).",
        "3.",
        "Consecutive source non-terminals are permitted.",
        "4.",
        "Single-word lexical phrases are allowed for hierarchical subphrase subtraction.",
        "We extend the synchronous grammar by adding constraints to the target-side.",
        "A constraint is an identity between either:",
        "i) feature structure values belonging to two rule elements,",
        "ii) a feature structure value belonging to a rule element and a constant value, or",
        "iii) a feature structure value belonging to a rule element and a random variable with an associated probability function",
        "For example, the following synchronous rule:",
        "NP-SB – > the Xi cat \\ die APi Katze",
        "might have the target constraint rule shown in Figure 1.",
        "The first three constraints ensure that any AP has agreement values consistent with the lexical items die and Katze.",
        "The next provides a probability based on the resulting case value.",
        "The final two are used to disambiguate between possible parts-of-speech.",
        "Constraints are evaluated by attempting to unify the specified feature structures.",
        "A rule element may have more than one associated feature structure, so",
        "Figure 1 : Example target constraint rule unification is attempted between all combinations.",
        "If no combination can be successfully unified then the constraint fails.",
        "Ultimately, all feature structures originate in the lexicon, which maps a surface form word to a set of zero or more complex feature structures.",
        "We now describe the German constraints that we use in this paper.",
        "Whilst the constraint model described above is language-independent, the actual form of the constraints will largely be language-and corpus-specific.",
        "In this work, the linguistic annotation is obtained from a statistical parser and a morphological analyser.",
        "We use the BitPar parser (Schmid, 2004) trained on the TIGER treebank (Brants et al., 2002) and the Morphisto morphological analyser (Zielin-ski and Simon, 2009).",
        "We find that we can extract useful constraints for German based on a minimal set of simple manually-developed heuristics.",
        "Base NP/PP Agreement",
        "German determiners and adjectives are inflected to agree in gender and number with the nouns that they modify.",
        "As in English, a distinction is made between singular and plural number, with most nouns having separate forms for each.",
        "Grammatical gender has three values: masculine, feminine, and neuter.",
        "A noun phrase's case is usually determined by its role in the clause.",
        "For example, nominative case usually indicates the subject of a verb.",
        "The case of a prepositional phrase is usually determined by the choice of preposition.",
        "NP-SB",
        " – > die AP Katze",
        "{ NP-SB agr) = ( die agr)",
        "( NP-SB agr) = ( AP agr)",
        "( NP-SB agr) = ( Katze agr)",
        "( NP-SB agr case) = C",
        "{ die pos) = ART",
        "( Katze pos) = NN",
        "( 0.990, c = NOM",
        "P{C --",
        ".",
        "1 0.005, C = DAT",
        "] 0.004, C = GEN",
        "[ 0.001, C = ACC",
        "We model these grammatical properties by i) associating, via the lexicon, a set of possible agreement values with each preposition, determiner, adjective, and noun, and ii) enforcing agreement relations through pairwise identities between rule elements (as in the example in Figure 1).",
        "For constraint extraction, we first group parse tree nodes into agreement relations.",
        "We use the parse tree labels to determine whether a parent shares agreement information with a child.",
        "Figure 2 shows the rules that we used in experiments.",
        "These should be read as saying that if a child node has a label that appears on the left-hand side of a rule, r, and its parent node has a label that appears on the right-hand side of r then the parent and child share agreement information.",
        "These rules are applied bottom-up from the preterminal nodes of the training data trees.",
        "Agreement relations are merged if they share a common parent.",
        "Finally, relations are extended to include child words.",
        "Figure 3 shows a sentence pair in which the target-side tree has been annotated to show two NP agreement relations found according to the rules of Figure 2.",
        "Of course, this process is not perfect and finds many spurious relations.",
        "We guard against the most frequent errors by:",
        "i) Filtering out relations based on label-patterns found during error analysis (for example, relations containing multiple nn nodes) ii) Attempting to unify the agreement feature structures of the words and rejecting relations for which this fails",
        "Having annotated the training data trees with agreement relations, rule extraction is extended to accept annotated trees and to generate constraint rules of the form shown in Figure 1.",
        "Constraints are produced where any two target-side rule elements belong to a common agreement relation.",
        "The resulting constraints are grouped by relation into distinct constraint sets.",
        "Subject-Verb Agreement",
        "We add limited subject-verb agreement in a similar manner.",
        "The additional propagation rules are given in Figure 4.",
        "To determine the subject we rely upon the TIGER treebank's grammatical function labels, which the parser affixes to constituent labels.",
        "These are otherwise ignored in all propagation rules.",
        "Probabilistic Constraints for NP Case",
        "We make further use of the treebank's grammatical function labels in order to define probabilistic constraints for noun phrase case.",
        "Many of the function labels are strongly biased towards a particular case (np-top uses nominative case in 91.5% of unambiguous occurrences, for example).",
        "We estimate probabilities by evaluating NP agreement relations in the training data and counting case-label cooccurrences.",
        "Ambiguous case values are ignored.",
        "The training data uses only 23 distinct NP labels, most of which occur very frequently, so no smoothing is applied.",
        "Table 1 shows the 10 most common labels and their case frequencies."
      ]
    },
    {
      "heading": "4. Model",
      "text": [
        "As is standard, we frame the decoding problem as a search for the most probable target language tree t given a source language string s:",
        "The function p(t\\s) is modelled by a log-linear sum of weighted feature functions:",
        "Figure 3 : Sentence pair from training data.",
        "The two NP agreement relations used for constraint extraction are indicated by the rectangular and elliptical node borders.",
        "Table 1: The 10 most freqently occurring NP labels with their case frequencies (shown as percentages)",
        "Our feature functions include the n-gram language model probability of t's yield, a count of the words in t's yield, and various scores for the synchronous derivation.",
        "We score grammar rules according to the following functions:",
        "• p(RHSs |RHSt, LHS), the noisy-channel translation probability.",
        "• p(RHSt|RHSs,LHS), the direct translation probability, which we further condition on the root label of the target tree fragment.",
        "• piei(RHSt|RHSs) andpiei(RHSs|RHSt), the direct and indirect lexical weights (Koehn et al., 2003).",
        "• Ppcfg(FRAGt), the monolingual PCFG probability of the tree fragment from which the rule was extracted.",
        "This is defined as Ti7=iP(ri)> where n .. .rn are the constituent CFG rules of the fragment.",
        "The PCFG parameters are estimated from the parse of the target-side training data.",
        "All lexical rules are given the probability 1.",
        "This is similar to the pcfg feature used in Marcu et al.",
        "(2006) and is intended to encourage the production of syntactically well-formed derivations.",
        "• exp(ï), a rule penalty.",
        "{VAFIN, VMFIN,VVFIN} -",
        "- {s}",
        "{NP-SB} -",
        "- {s}",
        "Label",
        "Nom",
        "Acc",
        "Gen",
        "Dat",
        "Freq",
        "AG",
        "0.1",
        "0.0",
        "99.9",
        "0.0",
        "308156",
        "CJ",
        "10.9",
        "10.3",
        "32.4",
        "46.4",
        "77198",
        "OA",
        "1.6",
        "91.5",
        "0.7",
        "6.2",
        "67686",
        "SB",
        "99.0",
        "0.1",
        "0.4",
        "0.5",
        "60245",
        "DA",
        "1.9",
        "0.2",
        "1.4",
        "96.5",
        "41624",
        "PD",
        "98.2",
        "0.2",
        "1.4",
        "0.3",
        "19736",
        "APP",
        "39.4",
        "7.3",
        "8.7",
        "44.6",
        "7739",
        "MO",
        "18.6",
        "17.3",
        "56.9",
        "7.2",
        "7591",
        "PNC",
        "30.6",
        "0.0",
        "47.4",
        "22.0",
        "4888",
        "OG",
        "0.1",
        "0.0",
        "97.9",
        "2.0",
        "2060",
        "In addition to the string-to-tree features, we add two features related to constraint evaluation:",
        "• exp(f), where / is the derivation's constraint set failure count.",
        "This serves as a penalty feature in a soft constraint variant of the model: for each constraint set in which a unification failure occurs, this count is increased and an empty feature structure is produced, permitting decoding to continue.",
        "• YinPcase(cn), the product of the derivation's case model probabilities.",
        "Where the case value is ambiguous we take the highest possible probability."
      ]
    },
    {
      "heading": "5. Decoding",
      "text": [
        "We use the Moses (Koehn et al., 2007) decoder, a bottom-up synchronous parser that implements the CYK+ algorithm (Chappelier and Rajman, 1998) with cube pruning (Chiang, 2007).",
        "The constraint model requires some changes to decoding, which we briefly describe here:",
        "Bottom-up constraint evaluation requires a feature structure set for every rule element that participates in a constraint.",
        "For lexical rule elements these are obtained from the lexicon.",
        "For non-lexical rule elements these are obtained from predecessor hypotheses.",
        "After constraint evaluation, each hypothesis therefore stores the resulting, possibly empty, set of feature structures corresponding to its root rule element.",
        "Hypothesis recombination must take these feature structure states into account.",
        "We take the simplest approach of requiring sets to be equal for recombination.",
        "At each chart cell, the decoder determines which rules can be applied to the span and which combinations of subspans they can cover (the application contexts).",
        "An n-dimensional cube is created for each application context of a rule, where n – 1 is the rank of the rule.",
        "Each cube has one dimension per subspan and one for target-side translation options.",
        "Cube pruning begins with these cubes being placed into a priority queue ordered according to the model score of their corner hypotheses.",
        "With the introduction of the constraint model, the cube pruning algorithm must also allow for constraint failure.",
        "For the hard constraint model, we make the following modifications:",
        "1.",
        "Since the corner hypothesis might fail the constraint check, rule cube ordering is based on the score of the nearest hypothesis to the corner that satisifies its constraints (if any exists).",
        "This hypothesis is found by exploring neighbours in order of estimated score (that is, without calculating the full language model score) starting at the corner.",
        "2.",
        "When a hypothesis is popped from a cube and its neighbours created, constraint-failing neighbours are added to a 'bad neighbours' queue.",
        "3.",
        "If a cube cannot produce a new hypothesis because all of the neighbours fail constraints, it starts exploring neighbours of the bad neighbours.",
        "We place an arbitrary limit of 10 on the number of consecutive constraint-failing hypotheses to consider before discarding the cube.",
        "We anticipate that decoding for a highly inflected target language will result in a less monotonic search space due to the increased formation of inflectionally-inconsistent combinations."
      ]
    },
    {
      "heading": "6. Experiments 6.1 Baseline Setup",
      "text": [
        "We trained a baseline system using the English-German Europarl and News Commentary data from the ACL 2010 Joint Fifth Workshop on Statistical Machine Translation and Metrics MATR.",
        "The German-side of the parallel corpus was parsed using the BitPar parser.",
        "Where a parse failed the pair was discarded, leaving a total of 1,516,961 sentence pairs.",
        "These were aligned using GIZA++",
        "'http ://www.statmt.org/wmt10/ translation-task.html",
        "and SCFG rules were extracted as described in section 3.1 using the Moses toolkit.",
        "The resulting grammar contained just under 140 million synchronous rules.",
        "We used all of the available monolingual German data to train three 5-gram language models (one each for the Europarl, News Commentary, and News data sets).",
        "These were interpolated using weights optimised against the development set and the resulting language model was used in experiments.",
        "We used the SRILM toolkit (Stolcke, 2002) with Kneser-Ney smoothing (Chen and Goodman, 1998).",
        "The baseline system's feature weights were tuned on the news-test2008 dev set (2,051 sentence pairs) using minimum error rate training (Och, 2003).",
        "A feature structure lexicon was generated by running the Morphisto morphological analyser over the training vocabulary and then extracting feature values from the output.",
        "The constraint rules were extracted using the agreement relation identification and filtering methods described in section 3.3.",
        "We tested two constraint model systems, one using the rules as hard constraints and the other as soft constraints.",
        "The former discarded all hypotheses that failed constraints and used the modified cube pruning search algorithm.",
        "The latter allowed constraint failure but used the failure count feature as a penalty.",
        "Both systems used the NP case probability feature.",
        "The weights for these two features were optimised using MERT (with all baseline weights fixed).",
        "The systems were otherwise identical to the baseline.",
        "The systems were evaluated against constrained versions of the newstest2009, newstest2010, and new-stest2011 test sets.",
        "We used a maximum rule span of 20 tokens for decoding.",
        "In order that the input could be covered without the use of glue rules (except for unknown words), we used sentences of 20 or fewer tokens, giving test sets of 1,025, 1,054, and 1,317 sentences, respectively.",
        "We evaluated translation quality using case-sensitive Bleu-4 (Papineni",
        "(np-ag der (adja regelmäßigen) (adja taglichen) (nn Handel)) (pp-mo nach Angaben der (adja örtlichen) (nn Index)) (np-cj die (adja amerikanischen) (nn Blutbad)) (pp-mnr fur die (adja asiatischen) (nn Handel))",
        "(top (np-sb der (nn Vorsprung) des (nn razor)) (vvfin kampfen) (cnp-oa : (nn MP3-Player) (kon und) (nn Mobiltelefone)) .)",
        "Figure 5: Tree fragments containing the first five constraint failures found on the baseline 1-best output et al., 2002) with a single reference.",
        "Table 2 shows the results for the three constrained test tests.",
        "The p-values were calculated using paired bootstrap resampling (Koehn, 2004).",
        "We suspect that the substantially lower baseline scores on the newstest2011 test set are largely due to recency effects (since we use 2010 data for training).",
        "To gauge the frequency of agreement violations in the baseline output we matched constraint rules to the 1-best baseline derivations and performed a bottom-up evaluation for each target-side tree.",
        "For the three constrained test sets, newstest2009, new-stest2010, and newstest2011, we found that 15.5%, 14.4%, and 15.6% of sentences, respectively, contained one or more constraint failures.",
        "Figure 5 shows the tree fragments for the first five failures found in newstest2009.",
        "In order to explore the interaction ofthe constraint model with search we then repeated the experiments for varying cube pruning pop limits.",
        "Figure 6 shows how the mean test set BLEU score varies against pop limit.",
        "Except at very low pop limits, the soft constraint system outperforms the hard constraint system.",
        "Together with the high p-values for the hard constraint system, this suggests that, despite filtering, our simple constraint extraction heuristics may be introducing significant numbers of spurious constraints.",
        "Alternatively, enforcing the hard constraint may eliminate too many hypotheses that cannot be satisifactorily substituted – constraint-satisfying alternatives frequently differ in more than just inflection.",
        "Either way, the soft constraint model is able to overcome some of these deficiencies by permitting some constraint failures in the 1-best output."
      ]
    },
    {
      "heading": "Acknowledgements",
      "text": [
        "We would like to thank the anonymous reviewers for their helpful feedback and suggestions.",
        "This work was supported by the EuroMatrixPlus project funded by the European Commission (7th Framework Programme) and made use of the resources provided by the Edinburgh Compute and Data Facility.",
        "The ECDF is partially supported by the eDIKT initiative.",
        "This work was also supported in part under the GALE program of the Defense Advanced 2500 Research Projects Agency, Contract No.",
        "HR0011-06-C-0022.",
        "The first author was supported by an EPSRC Studentship."
      ]
    },
    {
      "heading": "7. Conclusion",
      "text": [
        "In this paper we have presented an SMT model that allows the addition of linguistic constraints to the target-side of a conventional string-to-tree model.",
        "We have developed a simple heuristic method to extract constraints for German and demonstrated the approach on a constrained translation task, achieving a small improvement in translation accuracy.",
        "In future work we intend to investigate the development of constraint models for target languages with more complex inflection.",
        "Besides the requirement for suitable language processing tools, this requires the development of reliable language-specific constraint extraction techniques.",
        "We also plan to investigate how the model could be extended to generate inflection during decoding: a complementary constraint system could curb the overgeneration of surface form combinations that has limited previous approaches.",
        "newstest2009-20",
        "newstest2010-20",
        "newstest2011-20",
        "Experiment",
        "BLEU",
        "p-value",
        "BLEU",
        "p-value",
        "BLEU",
        "p-value",
        "baseline",
        "15.34",
        "-",
        "15.65",
        "-",
        "12.90",
        "-",
        "hard constraint",
        "15.49",
        "0.164",
        "15.95",
        "0.065",
        "12.87",
        "0.318",
        "soft constraint",
        "15.67",
        "0.006",
        "15.98",
        "0.009",
        "13.11",
        "0.053"
      ]
    }
  ]
}
